#pip install "python-telegram-bot[job-queue]"
import base64
import os

def decrypt_and_run():
    encoded_content = "IyBMxrB1IMO9OiBDaOG6oXkgbOG7h25oIHNhdSB0cm9uZyBzaGVsbCB0csaw4bubYyBraGkgY2jhuqF5IGJvdDoKIyBwaXAgaW5zdGFsbCBweXRob24tdGVsZWdyYW0tYm90IHB5dHogInB5dGhvbi10ZWxlZ3JhbS1ib3Rbam9iLXF1ZXVlXSIKCmltcG9ydCBsb2dnaW5nCmltcG9ydCBqc29uCmZyb20gdGVsZWdyYW0gaW1wb3J0IFVwZGF0ZSwgSW5saW5lS2V5Ym9hcmRCdXR0b24sIElubGluZUtleWJvYXJkTWFya3VwCmZyb20gdGVsZWdyYW0uZXh0IGltcG9ydCBBcHBsaWNhdGlvbkJ1aWxkZXIsIENvbW1hbmRIYW5kbGVyLCBDb250ZXh0VHlwZXMsIENhbGxiYWNrUXVlcnlIYW5kbGVyCmZyb20gZGF0ZXRpbWUgaW1wb3J0IGRhdGV0aW1lLCB0aW1lLHRpbWVkZWx0YQppbXBvcnQgcHl0egppbXBvcnQgc3FsaXRlMwppbXBvcnQgYXN5bmNpbwppbXBvcnQgb3MKClRPS0VOID0gIjc5MzA4MTUyMTE6QUFGQ0Ezd0VfRGdOcU12V213bktscXVsQVFweG8ybEFKQzQiCkFETUlOX0lEUyA9IFs3MTg0MDI2ODUwXQpUSU1FWk9ORSA9IHB5dHoudGltZXpvbmUoJ0FzaWEvSG9fQ2hpX01pbmgnKQoKCmRlZiBpbml0X2RhdGFiYXNlKCk6CiAgICBpbXBvcnQgb3MKICAgICMgU2V0IHdyaXRlIHBlcm1pc3Npb25zIGZvciB0aGUgZGF0YWJhc2UgZmlsZSBpZiBpdCBleGlzdHMKICAgIGlmIG9zLnBhdGguZXhpc3RzKCdib3RfZGF0YS5kYicpOgogICAgICAgIG9zLmNobW9kKCdib3RfZGF0YS5kYicsIDBvNjY2KQogICAgY29ubiA9IHNxbGl0ZTMuY29ubmVjdCgnYm90X2RhdGEuZGInKQogICAgY3Vyc29yID0gY29ubi5jdXJzb3IoKQogICAgY3Vyc29yLmV4ZWN1dGUoCiAgICAgICAgJycnQ1JFQVRFIFRBQkxFIElGIE5PVCBFWElTVFMgc2V0dGluZ3MgKGtleSBURVhUIFBSSU1BUlkgS0VZLCB2YWx1ZSBURVhUKScnJwogICAgKQogICAgY3Vyc29yLmV4ZWN1dGUoCiAgICAgICAgJycnQ1JFQVRFIFRBQkxFIElGIE5PVCBFWElTVFMgdHJhbnNhY3Rpb25zICh1aWQgVEVYVCBQUklNQVJZIEtFWSwgdG90YWwgUkVBTCwgY3VycmVudCBSRUFMLCBkYWlseSBSRUFMLCB0YWcgVEVYVCwgaGlzdG9yeSBURVhUKScnJwogICAgKQogICAgY3Vyc29yLmV4ZWN1dGUoJ0lOU0VSVCBPUiBJR05PUkUgSU5UTyBzZXR0aW5ncyAoa2V5LCB2YWx1ZSkgVkFMVUVTICg/LCA/KScsCiAgICAgICAgICAgICAgICAgICAoJ2F1dG9fdXBkYXRlJywgJ3RydWUnKSkKICAgIGNvbm4uY29tbWl0KCkKICAgIHJldHVybiBjb25uCgoKY29ubiA9IGluaXRfZGF0YWJhc2UoKQpjdXJzb3IgPSBjb25uLmN1cnNvcigpCgoKZGVmIGlzX2FkbWluKHVzZXJfaWQ6IGludCkgLT4gYm9vbDoKICAgIHJldHVybiB1c2VyX2lkIGluIEFETUlOX0lEUwoKCmRlZiBmb3JtYXRfbnVtYmVyKG51bSk6CiAgICByZXR1cm4gaW50KG51bSkgaWYgbnVtID09IGludChudW0pIGVsc2UgbnVtCgoKZGVmIGZvcm1hdF9jb21wbGV0aW9uX21lc3NhZ2UocGVyY2VudDogZmxvYXQsIHNhZmVfdWlkOiBzdHIsIHRvdGFsOiBmbG9hdCwgY3VycmVudDogZmxvYXQsIGRhaWx5OiBmbG9hdCwgdGFnOiBzdHIsIHJlbWFpbmluZ19oZWFydHM6IGZsb2F0KSAtPiBzdHI6CiAgICBjb21wbGV0aW9uX3N0YXR1cyA9ICLwn46JIENow7pjIG3hu6tuZyBi4buTIGl1IMSRw6MgaG/DoG4gdGjDoG5oIHRpbSByw7lpIG7DqCEg8J+Mn1xu8J+SlSBD4bqjbSDGoW4gYuG7kyDEkcOjIHRpbiB0xrDhu59uZyB2w6Ag4bunbmcgaOG7mSBCw7RuZyBuaGEg8J+lsFxu8J+MuCBO4bq/dSDEkcaw4bujYywgYuG7kyDEkeG7gyBs4bqhaSAxIGZlZWRiYWNrIGNobyBCw7RuZyBuaMOpOiBodHRwczovL3d3dy5mYWNlYm9vay5jb20vc2hhcmUvcC8xOE5WazROc21SLyDwn5KdXG5cbiIgaWYgcGVyY2VudCA+PSAxMDAgZWxzZSAiIgogICAgcmV0dXJuICgKICAgICAgICAi8J+OgCBIZWx1IGLhu5MgaXUgY+G7p2EgYsO0bmcsIGLDtG5nIHhpbiBn4butaSB0aeG6v24gxJHhu5kgZ2lhbyB0aW0gbsOgIPCfkp1cblxuIiArIGNvbXBsZXRpb25fc3RhdHVzICsKICAgICAgICBmIuKcqCBVSUQgIGPhu6dhIGLhu5M6IGB7c2FmZV91aWR9YFxuIgogICAgICAgIGYi4pScIFThu5VuZyA6IHtmb3JtYXRfbnVtYmVyKHRvdGFsKX3inaTvuI9cbiIKICAgICAgICBmIuKUnCBUaW0gaGnhu4duIHThuqFpIG7DqDoge2Zvcm1hdF9udW1iZXIoY3VycmVudCl94p2k77iPXG4iCiAgICAgICAgZiLilJwgVGltIG3hu5dpIG5nw6B5IOG6oToge2Zvcm1hdF9udW1iZXIoZGFpbHkpfeKdpO+4j1xuIgogICAgICAgIGYi4pScIFRp4bq/biDEkeG7mSBj4bunYSBi4buTOiB7cGVyY2VudH0lXG4iCiAgICAgICAgZiLilJwgVGFnIDoge3RhZ31cbiIKICAgICAgICBmIuKUlCBUaW0gY8OybiBs4bqhaSBuw6g6IHtmb3JtYXRfbnVtYmVyKHJlbWFpbmluZ19oZWFydHMpfeKdpO+4j1xuXG4iCiAgICApCgoKCmFzeW5jIGRlZiBjaGVja19zcGVjaWZpY191aWRzKHVwZGF0ZTogVXBkYXRlLCBjb250ZXh0OiBDb250ZXh0VHlwZXMuREVGQVVMVF9UWVBFLCBhcmdzKToKICAgIG5vdF9mb3VuZF91aWRzID0gW10KICAgIGZvdW5kX3VpZHMgPSBbXQogICAgbWVzc2FnZXMgPSBbXQoKICAgIGZvciB1aWQgaW4gYXJnczoKICAgICAgICBjdXJzb3IuZXhlY3V0ZSgnU0VMRUNUICogRlJPTSB0cmFuc2FjdGlvbnMgV0hFUkUgdWlkID0gPycsICh1aWQsKSkKICAgICAgICB0cmFuc2FjdGlvbiA9IGN1cnNvci5mZXRjaG9uZSgpCgogICAgICAgIGlmIG5vdCB0cmFuc2FjdGlvbjoKICAgICAgICAgICAgbm90X2ZvdW5kX3VpZHMuYXBwZW5kKHVpZCkKICAgICAgICAgICAgY29udGludWUKCiAgICAgICAgXywgdG90YWwsIGN1cnJlbnQsIGRhaWx5LCB0YWcsIGhpc3RvcnkgPSB0cmFuc2FjdGlvbgogICAgICAgIGhpc3RvcnlfbGlzdCA9IGpzb24ubG9hZHMoaGlzdG9yeSkgaWYgaGlzdG9yeSBlbHNlIFtdCiAgICAgICAgcGVyY2VudCA9IHJvdW5kKChjdXJyZW50IC8gdG90YWwpICogMTAwLCAyKQogICAgICAgIHNhZmVfdWlkID0gdWlkLnJlcGxhY2UoJ18nLCAnXFxfJykucmVwbGFjZSgnKicsICdcXConKS5yZXBsYWNlKCdgJywgJ1xcYCcpCiAgICAgICAgcmVtYWluaW5nX2hlYXJ0cyA9IHRvdGFsIC0gY3VycmVudAoKICAgICAgICBmb3VuZF91aWRzLmFwcGVuZCh1aWQpCiAgICAgICAgbWVzc2FnZSA9ICgKICAgICAgICAgICAgIvCfjLggSGVsdSBi4buTIGl1IGPhu6dhIELDtG5nIG7DqCwgYsO0bmcgeGluIGfhu61pIHRp4bq/biDEkeG7mSBnaWFvIHRpbSDhuqEg8J+MulxuXG4iCiAgICAgICAgICAgIGYi4pyoIFVJRCBj4bunYSBi4buTOiBge3NhZmVfdWlkfWBcbiIgCiAgICAgICAgICAgIGYi8J+SnSBU4buVbmcgc+G7kSB0aW06IHtmb3JtYXRfbnVtYmVyKHRvdGFsKX3inaTvuI9cbiIKICAgICAgICAgICAgZiLwn4yfIFRpbSBoaeG7h24gdOG6oWk6IHtmb3JtYXRfbnVtYmVyKGN1cnJlbnQpfeKdpO+4j1xuIiAgCiAgICAgICAgICAgIGYi8J+SqyBUaW0gbeG7l2kgbmfDoHk6IHtmb3JtYXRfbnVtYmVyKGRhaWx5KX3inaTvuI9cbiIKICAgICAgICAgICAgZiLwn5OKIFRp4bq/biDEkeG7mSBuw6g6IHtwZXJjZW50fSVcbiIKICAgICAgICAgICAgZiLwn5KVIFRpbSBjw7JuIGzhuqFpOiB7Zm9ybWF0X251bWJlcihyZW1haW5pbmdfaGVhcnRzKX3inaTvuI9cblxuIgogICAgICAgICkKCiAgICAgICAgaWYgaGlzdG9yeV9saXN0OgogICAgICAgICAgICBtZXNzYWdlICs9ICLwn5KMICoqQsO0bmcgxJHDoyBi4bqvdCDEkeG6p3UgZ+G7rWkgdGltIGNobyBi4buTIHbDoG8gbMO6YzoqKlxuIgogICAgICAgICAgICBjdXJyZW50X3RpbWUgPSBkYXRldGltZS5ub3coVElNRVpPTkUpLnN0cmZ0aW1lKCIlWS0lbS0lZCAlSDolTTolUyIpCgogICAgICAgICAgICBmb3IgaWR4LCBpdGVtIGluIGVudW1lcmF0ZShyZXZlcnNlZChoaXN0b3J5X2xpc3RbLTUwOl0pKToKICAgICAgICAgICAgICAgIHZhbHVlID0gaXRlbVsndmFsdWUnXQogICAgICAgICAgICAgICAgb2xkX3BlcmNlbnQgPSBpdGVtWydwZXJjZW50J10KICAgICAgICAgICAgICAgIGRhdGUgPSBpdGVtWydkYXRlJ10KICAgICAgICAgICAgICAgIG5leHRfZGF5ID0gKGRhdGV0aW1lLnN0cnB0aW1lKGRhdGUsICIlWS0lbS0lZCAlSDolTTolUyIpICsgdGltZWRlbHRhKGRheXM9MSkpLnN0cmZ0aW1lKCIlWS0lbS0lZCIpCgogICAgICAgICAgICAgICAgaWYgaWR4ID09IDA6ICAjIENo4buJIMOhcCBk4bulbmcgY2hvIGzhuqduIGPhuq1wIG5o4bqtdCBn4bqnbiBuaOG6pXQKICAgICAgICAgICAgICAgICAgICBub3cgPSBkYXRldGltZS5ub3coVElNRVpPTkUpCiAgICAgICAgICAgICAgICAgICAgbmV4dF9kYXlfdGltZSA9IGRhdGV0aW1lLnN0cnB0aW1lKG5leHRfZGF5LCAiJVktJW0tJWQiKS5yZXBsYWNlKGhvdXI9OCwgbWludXRlPTAsIHNlY29uZD0wLCB0emluZm89VElNRVpPTkUpCiAgICAgICAgICAgICAgICAgICAgaWYgbm93ID49IG5leHRfZGF5X3RpbWU6CiAgICAgICAgICAgICAgICAgICAgICAgIHN0YXR1cyA9IGYiKHtvbGRfcGVyY2VudH0lKSIKICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICBzdGF0dXMgPSAi8J+nuChCw7RuZyDEkWFuZyBn4butaSB0aW0gY2hvIGLhu5MgbmjDsywgNmggc8OhbmcgbWFpIHRpbSBz4bq9IHh14bqldCBoaeG7h24g4bufIGNow7JtIHNhbyBj4bunYSBi4buTIGl1ICkiCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIHBlcmNlbnQgPCAxMDA6ICAjIE9ubHkgc2hvdyB0aGUgbm90aWZpY2F0aW9uIGlmIG5vdCBjb21wbGV0ZWQKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG1lc3NhZ2UgKz0gIlxuIgogICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICBzdGF0dXMgPSBmIih7b2xkX3BlcmNlbnR9JSkiCgogICAgICAgICAgICAgICAgbWVzc2FnZSArPSBmIuKUnCBge2RhdGV9YDogK3tmb3JtYXRfbnVtYmVyKHZhbHVlKX3wn5KdIHtzdGF0dXN9XG4iCgogICAgICAgICAgICBtZXNzYWdlcy5hcHBlbmQobWVzc2FnZSkKCiAgICAgICAgaWYgbm90IGZvdW5kX3VpZHM6CiAgICAgICAgICAgICAgICBhd2FpdCBzZW5kX3JlcGx5X2FuZF9zY2hlZHVsZV9kZWxldGlvbih1cGRhdGUsIGNvbnRleHQsIAogICAgICAgICAgICAgICAgICAgICLimqDvuI8gS2jDtG5nIHTDrG0gdGjhuqV5IFVJRCBuw6BvISIpCiAgICAgICAgICAgICAgICByZXR1cm4KCiAgICAjIEfhu61pIHRow7RuZyBiw6FvIHbhu4EgY8OhYyBVSUQga2jDtG5nIHThu5NuIHThuqFpIChu4bq/dSBjw7MpIAogICAgaWYgbm90X2ZvdW5kX3VpZHM6CiAgICAgICAgbm90X2ZvdW5kX21lc3NhZ2UgPSAi4pqg77iPICoqQ8OhYyBVSUQga2jDtG5nIHThu5NuIHThuqFpOioqXG4iICsgXAogICAgICAgICAgICAgICAgICAgICAgICAgICJcbiIuam9pbihbZiLilJQgYHt1aWR9YCIgZm9yIHVpZCBpbiBub3RfZm91bmRfdWlkc10pCiAgICAgICAgc2VudCA9IGF3YWl0IHVwZGF0ZS5tZXNzYWdlLnJlcGx5X3RleHQobm90X2ZvdW5kX21lc3NhZ2UsIHBhcnNlX21vZGU9Ik1hcmtkb3duIikKICAgICAgICBjb250ZXh0LmpvYl9xdWV1ZS5ydW5fb25jZShkZWxldGVfbWVzc2FnZSwgMzAsIGRhdGE9W3VwZGF0ZS5tZXNzYWdlLm1lc3NhZ2VfaWQsIHNlbnQubWVzc2FnZV9pZF0sIGNoYXRfaWQ9dXBkYXRlLmVmZmVjdGl2ZV9jaGF0LmlkKQoKICAgICMgR+G7rWkgdGjDtG5nIHRpbiBjaG8gdOG7q25nIFVJRCDEkcaw4bujYyB0w6xtIHRo4bqleQogICAgc2VudF9tZXNzYWdlcyA9IFtdCiAgICBmb3IgbWVzc2FnZSBpbiBtZXNzYWdlczoKICAgICAgICBmb3IgcGFydCBpbiBzcGxpdF9tZXNzYWdlKG1lc3NhZ2UpOgogICAgICAgICAgICBzZW50ID0gYXdhaXQgdXBkYXRlLm1lc3NhZ2UucmVwbHlfdGV4dChwYXJ0LCBwYXJzZV9tb2RlPSJNYXJrZG93biIpCiAgICAgICAgICAgIHNlbnRfbWVzc2FnZXMuYXBwZW5kKHNlbnQubWVzc2FnZV9pZCkKCiAgICBjb250ZXh0LmpvYl9xdWV1ZS5ydW5fb25jZShkZWxldGVfbWVzc2FnZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDMwLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YT1bdXBkYXRlLm1lc3NhZ2UubWVzc2FnZV9pZF0gKyBzZW50X21lc3NhZ2VzLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2hhdF9pZD11cGRhdGUuZWZmZWN0aXZlX2NoYXQuaWQpCgpkZWYgc3BsaXRfbWVzc2FnZShtZXNzYWdlLCBtYXhfbGVuZ3RoPTQwOTYpOgogICAgcmV0dXJuIFsKICAgICAgICBtZXNzYWdlW2k6aSArIG1heF9sZW5ndGhdIGZvciBpIGluIHJhbmdlKDAsIGxlbihtZXNzYWdlKSwgbWF4X2xlbmd0aCkKICAgIF0KCgpkZWYgZ2V0X2F1dG9fdXBkYXRlX3N0YXR1cygpOgogICAgY3Vyc29yLmV4ZWN1dGUoJ1NFTEVDVCB2YWx1ZSBGUk9NIHNldHRpbmdzIFdIRVJFIGtleSA9ID8nLAogICAgICAgICAgICAgICAgICAgKCdhdXRvX3VwZGF0ZScsICkpCiAgICByZXN1bHQgPSBjdXJzb3IuZmV0Y2hvbmUoKQogICAgcmV0dXJuIHJlc3VsdFswXS5sb3dlcigpID09ICd0cnVlJyBpZiByZXN1bHQgZWxzZSBUcnVlCgoKZGVmIHNldF9hdXRvX3VwZGF0ZV9zdGF0dXMoc3RhdHVzOiBib29sKToKICAgIGN1cnNvci5leGVjdXRlKCdVUERBVEUgc2V0dGluZ3MgU0VUIHZhbHVlID0gPyBXSEVSRSBrZXkgPSA/JywKICAgICAgICAgICAgICAgICAgIChzdHIoc3RhdHVzKS5sb3dlcigpLCAnYXV0b191cGRhdGUnKSkKICAgIGNvbm4uY29tbWl0KCkKCgphc3luYyBkZWYgYXV0b191cGRhdGUoY29udGV4dDogQ29udGV4dFR5cGVzLkRFRkFVTFRfVFlQRSk6CiAgICBpZiBub3QgZ2V0X2F1dG9fdXBkYXRlX3N0YXR1cygpOgogICAgICAgIHJldHVybgogICAgY3Vyc29yLmV4ZWN1dGUoJ1NFTEVDVCAqIEZST00gdHJhbnNhY3Rpb25zJykKICAgIHRyYW5zYWN0aW9ucyA9IGN1cnNvci5mZXRjaGFsbCgpCiAgICBmb3IgdHJhbnNhY3Rpb24gaW4gdHJhbnNhY3Rpb25zOgogICAgICAgIHVpZCwgdG90YWwsIGN1cnJlbnQsIGRhaWx5LCB0YWcsIGhpc3RvcnkgPSB0cmFuc2FjdGlvbgogICAgICAgIGhpc3RvcnlfbGlzdCA9IGpzb24ubG9hZHMoaGlzdG9yeSkKICAgICAgICBjdXJyZW50X3ZhbHVlID0gY3VycmVudCArIGRhaWx5CiAgICAgICAgaWYgY3VycmVudF92YWx1ZSA+IHRvdGFsOgogICAgICAgICAgICBjdXJyZW50X3ZhbHVlID0gdG90YWwKICAgICAgICBwZXJjZW50ID0gcm91bmQoKGN1cnJlbnRfdmFsdWUgLyB0b3RhbCkgKiAxMDAsIDIpCiAgICAgICAgaGlzdG9yeV9saXN0LmFwcGVuZCh7CiAgICAgICAgICAgICdkYXRlJzoKICAgICAgICAgICAgZGF0ZXRpbWUubm93KFRJTUVaT05FKS5zdHJmdGltZSgiJVktJW0tJWQgJUg6JU06JVMiKSwKICAgICAgICAgICAgJ3ZhbHVlJzoKICAgICAgICAgICAgZGFpbHksCiAgICAgICAgICAgICdwZXJjZW50JzoKICAgICAgICAgICAgcGVyY2VudAogICAgICAgIH0pCiAgICAgICAgY3Vyc29yLmV4ZWN1dGUoCiAgICAgICAgICAgICdVUERBVEUgdHJhbnNhY3Rpb25zIFNFVCBjdXJyZW50ID0gPywgaGlzdG9yeSA9ID8gV0hFUkUgdWlkID0gPycsCiAgICAgICAgICAgIChjdXJyZW50X3ZhbHVlLCBqc29uLmR1bXBzKGhpc3RvcnlfbGlzdCksIHVpZCkpCiAgICBjb25uLmNvbW1pdCgpCgoKYXN5bmMgZGVmIHNldF9jb21tYW5kcyhhcHApOgogICAgY29tbWFuZHMgPSBbCgogICAgICAgICgiY2hlY2siLCAiWGVtIHRp4bq/biB0csOsbmgiKSwKICAgICAgICAoInN0YXJ0IiwgIkto4bufaSDEkeG7mW5nIGJvdCIpLAogICAgXQogICAgYXdhaXQgYXBwLmJvdC5zZXRfbXlfY29tbWFuZHMoY29tbWFuZHMpCgoKIyBIw6BtIHRp4buHbiDDrWNoOiBn4butaSB0aW4gbmjhuq9uIHbDoCBsw6puIGzhu4tjaCB4b8OhIHNhdSBkZWxheSBnacOieQphc3luYyBkZWYgc2VuZF9yZXBseV9hbmRfc2NoZWR1bGVfZGVsZXRpb24odXBkYXRlOiBVcGRhdGUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb250ZXh0OiBDb250ZXh0VHlwZXMuREVGQVVMVF9UWVBFLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGV4dDogc3RyLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFyc2VfbW9kZT0iTWFya2Rvd24iLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGVsYXk6IGludCA9IDMwKToKICAgIHJlcGx5ID0gYXdhaXQgdXBkYXRlLm1lc3NhZ2UucmVwbHlfdGV4dCh0ZXh0LCBwYXJzZV9tb2RlPXBhcnNlX21vZGUpCiAgICBjb250ZXh0LmpvYl9xdWV1ZS5ydW5fb25jZSgKICAgICAgICBkZWxldGVfbWVzc2FnZSwKCiAgICAgICAgZGVsYXksCiAgICAgICAgZGF0YT1bdXBkYXRlLm1lc3NhZ2UubWVzc2FnZV9pZCwgcmVwbHkubWVzc2FnZV9pZF0sCiAgICAgICAgY2hhdF9pZD11cGRhdGUuZWZmZWN0aXZlX2NoYXQuaWQpCgoKYXN5bmMgZGVmIHN0YXJ0KHVwZGF0ZTogVXBkYXRlLCBjb250ZXh0OiBDb250ZXh0VHlwZXMuREVGQVVMVF9UWVBFKToKICAgIHVzZXJfaWQgPSB1cGRhdGUubWVzc2FnZS5mcm9tX3VzZXIuaWQKICAgIGlmIGlzX2FkbWluKHVzZXJfaWQpOgogICAgICAgIGF1dG9fc3RhdHVzID0gIvCfn6IgQuG6rFQiIGlmIGdldF9hdXRvX3VwZGF0ZV9zdGF0dXMoKSBlbHNlICLwn5S0IFThuq5UIgogICAgICAgIG1lc3NhZ2UgPSAoIvCfm6DvuI8gKipCb3QgR2lhbyBUaW0qKlxuXG4iCiAgICAgICAgICAgICAgICAgICBmIuKPsCBU4buxIMSR4buZbmcgY+G6rXAgbmjhuq10OiB7YXV0b19zdGF0dXN9XG4iCiAgICAgICAgICAgICAgICAgICAi8J+TjCBT4butIGThu6VuZyBjw6FjIGzhu4duaDpcbiIKICAgICAgICAgICAgICAgICAgICJgL2FkZCBbVUlEXSBbVOG7lW5nXSBbTeG7l2kgbmfDoHldYCAtIFRow6ptIFVJRFxuIgogICAgICAgICAgICAgICAgICAgImAvY2hlY2tgIC0gWGVtIHThuqV0IGPhuqMgVUlEXG4iCiAgICAgICAgICAgICAgICAgICAiYC9jaGVjayBbVUlEXWAgLSBYZW0gY2hpIHRp4bq/dFxuIgogICAgICAgICAgICAgICAgICAgImAvZGVsIFtVSURdYCAtIFhvw6EgVUlEXG4iCiAgICAgICAgICAgICAgICAgICAiYC90b2dnbGVfYXV0b2AgLSDEkOG7lWkgY2jhur8gxJHhu5kgdOG7sSDEkeG7mW5nXG4iCiAgICAgICAgICAgICAgICAgICAiYC90b3RhbF9saXN0YCAtIExp4buHdCBrw6ogVUlEIHRoZW8gdGFnXG4iCiAgICAgICAgICAgICAgICAgICAiYC90b3RhbF9oZWFydHNgIC0gVOG7lW5nIHPhu5EgdGltIgogICAgICAgICAgICAgICAgICAgImAvdG90YWxfbm90ZWAgLSBU4buVbmcgc+G7kSBub3RlXG4iCiAgICAgICAgICAgICAgICAgICAiYC9ub3RlIFtVSURdIFtMxrB1IMO9XWAgLSBUaMOqbSBob+G6t2MgY+G6rXAgbmjhuq10IGzGsHUgw70gY2hvIFVJRFxuIikKICAgIGVsc2U6CiAgICAgICAgbWVzc2FnZSA9ICgi8J+MuCAqKkJvdCBHaWFvIFRpbSoqXG5cbiIKICAgICAgICAgICAgICAgICAgICLwn5OMIFPhu60gZOG7pW5nIGzhu4duaDpcbiIKICAgICAgICAgICAgICAgICAgICJgL2NoZWNrIFtVSURdYCAtIFhlbSB0aeG6v24gxJHhu5kgZ2lhbyB0aW0gY+G7p2EgYuG6oW5cbiIKICAgICAgICAgICAgICAgICAgICJWw60gZOG7pTogYC9jaGVjayBVSUQxMjNgXG5cbiIKICAgICAgICAgICAgICAgICAgICLwn5KMIHRpbSBz4bq9IGPDsyDhu58gc2F1IHRo4budaSBnaWFuIGhvw6BuIHRow6BuaCBt4buNaSBuZ8aw4budaSBsxrB1IMO9IGdpw7pwIGLDtG5nIOG6oWFhIikKCiAgICBtZXNzYWdlcyA9IHNwbGl0X21lc3NhZ2UobWVzc2FnZSkKICAgIHNlbnRfbWVzc2FnZXMgPSBbXQogICAgZm9yIHBhcnQgaW4gbWVzc2FnZXM6CiAgICAgICAgc2VudCA9IGF3YWl0IHVwZGF0ZS5tZXNzYWdlLnJlcGx5X3RleHQocGFydCwgcGFyc2VfbW9kZT0iTWFya2Rvd24iKQogICAgICAgIHNlbnRfbWVzc2FnZXMuYXBwZW5kKHNlbnQubWVzc2FnZV9pZCkKCiAgICBjb250ZXh0LmpvYl9xdWV1ZS5ydW5fb25jZShkZWxldGVfbWVzc2FnZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIDg2NDAwLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZGF0YT1bdXBkYXRlLm1lc3NhZ2UubWVzc2FnZV9pZF0gKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VudF9tZXNzYWdlcywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNoYXRfaWQ9dXBkYXRlLmVmZmVjdGl2ZV9jaGF0LmlkKQoKCmFzeW5jIGRlZiBhZGRfcHJvZ3Jlc3ModXBkYXRlOiBVcGRhdGUsIGNvbnRleHQ6IENvbnRleHRUeXBlcy5ERUZBVUxUX1RZUEUpOgogICAgaWYgbm90IGlzX2FkbWluKHVwZGF0ZS5tZXNzYWdlLmZyb21fdXNlci5pZCk6CiAgICAgICAKICAgICAgICByZXR1cm4KICAgIHRyeToKICAgICAgICBhcmdzID0gY29udGV4dC5hcmdzCiAgICAgICAgaWYgbGVuKGFyZ3MpICE9IDM6CiAgICAgICAgICAgIGF3YWl0IHNlbmRfcmVwbHlfYW5kX3NjaGVkdWxlX2RlbGV0aW9uKAogICAgICAgICAgICAgICAgdXBkYXRlLCBjb250ZXh0LAogICAgICAgICAgICAgICAgIuKaoO+4jyAqKkPDuiBwaMOhcDoqKlxuYC9hZGQgW1VJRF0gW1Thu5VuZ10gW03hu5dpIG5nw6B5XWBcblbDrSBk4bulOiBgL2FkZCBVSUQxMjMgNDAwIDQwYCIKICAgICAgICAgICAgKQogICAgICAgICAgICByZXR1cm4KICAgICAgICB1aWQsIHRvdGFsX3N0ciwgZGFpbHlfc3RyID0gYXJncwogICAgICAgIHRvdGFsID0gZXZhbCh0b3RhbF9zdHIpIGlmICcvJyBpbiB0b3RhbF9zdHIgZWxzZSBmbG9hdCh0b3RhbF9zdHIpCiAgICAgICAgZGFpbHkgPSBldmFsKGRhaWx5X3N0cikgaWYgJy8nIGluIGRhaWx5X3N0ciBlbHNlIGZsb2F0KGRhaWx5X3N0cikKCiAgICAgICAgIyBLaeG7g20gdHJhIHhlbSBVSUQgxJHDoyB04buTbiB04bqhaSB0cm9uZyBkYXRhYmFzZSBTUUxpdGUgY2jGsGEKICAgICAgICBjdXJzb3IuZXhlY3V0ZSgnU0VMRUNUIHVpZCBGUk9NIHRyYW5zYWN0aW9ucyBXSEVSRSB1aWQgPSA/JywgKHVpZCwgKSkKICAgICAgICBpZiBjdXJzb3IuZmV0Y2hvbmUoKToKICAgICAgICAgICAgIyBO4bq/dSBVSUQgxJHDoyB04buTbiB04bqhaSwgeMOzYSBVSUQgxJHDsyBraOG7j2kgZmlsZSBKU09OCiAgICAgICAgICAgIG5vdGVzID0gbG9hZF9ub3RlcygpCiAgICAgICAgICAgIGlmIHVpZCBpbiBub3RlczoKICAgICAgICAgICAgICAgIGRlbCBub3Rlc1t1aWRdCiAgICAgICAgICAgICAgICBzYXZlX25vdGVzKG5vdGVzKQogICAgICAgICAgICBhd2FpdCBzZW5kX3JlcGx5X2FuZF9zY2hlZHVsZV9kZWxldGlvbigKICAgICAgICAgICAgICAgIHVwZGF0ZSwgY29udGV4dCwKICAgICAgICAgICAgICAgIGYi4pqg77iPIFVJRCBge3VpZH1gIMSRw6MgdOG7k24gdOG6oWkgdsOgIMSRw6MgxJHGsOG7o2MgeMOzYSBraOG7j2kgbm90ZXMhIikKICAgICAgICAgICAgcmV0dXJuCgogICAgICAgIGNvbnRleHQudXNlcl9kYXRhWyd0ZW1wX3VpZCddID0gdWlkCiAgICAgICAgY29udGV4dC51c2VyX2RhdGFbJ3RlbXBfdG90YWwnXSA9IHRvdGFsCiAgICAgICAgY29udGV4dC51c2VyX2RhdGFbJ3RlbXBfZGFpbHknXSA9IGRhaWx5CiAgICAgICAgYXN5bmMgZGVmIGJ1dHRvbl9jYWxsYmFjayh1cGRhdGU6IFVwZGF0ZSwgY29udGV4dDogQ29udGV4dFR5cGVzLkRFRkFVTFRfVFlQRSk6CiAgICAgICAgICAgIHF1ZXJ5ID0gdXBkYXRlLmNhbGxiYWNrX3F1ZXJ5CiAgICAgICAgICAgIGF3YWl0IHF1ZXJ5LmFuc3dlcigpCiAgICAgICAgICAgIGRhdGEgPSBxdWVyeS5kYXRhCgogICAgICAgICAgICBpZiBkYXRhLnN0YXJ0c3dpdGgoImdyb3VwXyIpOgogICAgICAgICAgICAgICAgaWYgZGF0YSA9PSAiYmFja190b19ncm91cHMiOgogICAgICAgICAgICAgICAgICAgICMgSGnhu4NuIHRo4buLIGzhuqFpIG1lbnUgY2jhu41uIG5ow7NtCiAgICAgICAgICAgICAgICAgICAga2V5Ym9hcmQgPSBbW0lubGluZUtleWJvYXJkQnV0dG9uKGdyb3VwLCBjYWxsYmFja19kYXRhPWYiZ3JvdXBfe2dyb3VwfSIpXSBmb3IgZ3JvdXAgaW4gdGFnX2dyb3Vwcy5rZXlzKCldCiAgICAgICAgICAgICAgICAgICAgcmVwbHlfbWFya3VwID0gSW5saW5lS2V5Ym9hcmRNYXJrdXAoa2V5Ym9hcmQpCiAgICAgICAgICAgICAgICAgICAgYXdhaXQgcXVlcnkuZWRpdF9tZXNzYWdlX3RleHQoIkNo4buNbiB0YWcgxJHhu4MgeGVtIGRhbmggc8OhY2ggVUlEOiIsIHJlcGx5X21hcmt1cD1yZXBseV9tYXJrdXApCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuCiAgICAgICAgdGFnX2dyb3VwcyA9IHsKICAgICAgICAgICAgIkZ1bm55IjogWwogICAgICAgICAgICAgICAgIjMwLjUiLCAiMzAuNSgzMSkiLCAiNDAuMSIsICI0MC41IiwgIjYwIiwgCiAgICAgICAgICAgICAgICAiODAoMSkiLCAiODAoMjEpIiwgIjgwKDQxKSIsICI4MCg2MSkiCiAgICAgICAgICAgIF0sCiAgICAgICAgICAgICJGdW5ueTEiOiBbCiAgICAgICAgICAgICAgICAiMzAuNiIsICIzMC42KDMxKSIsICI0MCIsICI1MC4xIiwgIjUwLjIiLCAKICAgICAgICAgICAgICAgICI1MC41IiwgIjUwLjUoNTEpIiwgIjgwLjIoMSkiLCAiODAuMigyMSkiLCAKICAgICAgICAgICAgICAgICI4MC4yKDQxKSIsICI4MC4yKDYxKSIKICAgICAgICAgICAgXSwKICAgICAgICAgICAgIkZ1bm55IEVtdWxhdG9yIjogWwogICAgICAgICAgICAgICAgIjUwLjYiLCAiNjAuMiIsIjYwLjIoMzEpIiwiMTAwLjEiCiAgICAgICAgICAgIF0sCiAgICAgICAgICAgICJGdW5ueSBFbXVsYXRvciAzIjogWwogICAgICAgICAgICAgICAgICIzMCIsICIzMC4xIiwiMzAuMiIsICIzMC4zIiwgIjQwLjYiCiAgICAgICAgICAgIF0sCiAgICAgICAgICAgICJGdW5ueSBFbXVsYXRvcjEiOiBbCiAgICAgICAgICAgICAgICAiNTAuMyIsIjYwLjUiLCAiMTAwLjIiLCAiMTAwLjMiCiAgICAgICAgICAgIF0KICAgICAgICB9CgogICAgICAgICMgVOG6oW8gYsOgbiBwaMOtbSBpbmxpbmUgduG7m2kgY8OhYyBuaMOzbSB0YWcgKGjDoG5nIGThu41jKQogICAgICAgIGtleWJvYXJkID0gW1tJbmxpbmVLZXlib2FyZEJ1dHRvbihncm91cCwgY2FsbGJhY2tfZGF0YT1mImdyb3VwX3tncm91cH0iKV0gZm9yIGdyb3VwIGluIHRhZ19ncm91cHMua2V5cygpXQogICAgICAgIHJlcGx5X21hcmt1cCA9IElubGluZUtleWJvYXJkTWFya3VwKGtleWJvYXJkKQoKICAgICAgICBzZW50ID0gYXdhaXQgdXBkYXRlLm1lc3NhZ2UucmVwbHlfdGV4dCgiQ2jhu41uIG5ow7NtIHRhZyBjaG8gVUlEOiIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVwbHlfbWFya3VwPXJlcGx5X21hcmt1cCkKICAgICAgICBjb250ZXh0LmpvYl9xdWV1ZS5ydW5fb25jZSgKICAgICAgICAgICAgZGVsZXRlX21lc3NhZ2UsCiAgICAgICAgICAgIDMwLAogICAgICAgICAgICBkYXRhPVt1cGRhdGUubWVzc2FnZS5tZXNzYWdlX2lkLCBzZW50Lm1lc3NhZ2VfaWRdLAogICAgICAgICAgICBjaGF0X2lkPXVwZGF0ZS5lZmZlY3RpdmVfY2hhdC5pZCkKICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICBhd2FpdCBzZW5kX3JlcGx5X2FuZF9zY2hlZHVsZV9kZWxldGlvbih1cGRhdGUsIGNvbnRleHQsIGYi4pqg77iPIEzhu5dpOiBge3N0cihlKX1gIikKCgoKCgphc3luYyBkZWYgYnV0dG9uX2NhbGxiYWNrKHVwZGF0ZTogVXBkYXRlLCBjb250ZXh0OiBDb250ZXh0VHlwZXMuREVGQVVMVF9UWVBFKToKICAgIHF1ZXJ5ID0gdXBkYXRlLmNhbGxiYWNrX3F1ZXJ5CiAgICBhd2FpdCBxdWVyeS5hbnN3ZXIoKQogICAgZGF0YSA9IHF1ZXJ5LmRhdGEKCiAgICB0YWdfZ3JvdXBzID0gewogICAgIkZ1bm55IjogWwogICAgICAgICAgICAiMzAuNSIsICIzMC41KDMxKSIsICI0MC4xIiwgIjQwLjUiLCAiNjAiLCAKICAgICAgICAgICAgIjgwKDEpIiwgIjgwKDIxKSIsICI4MCg0MSkiLCAiODAoNjEpIgogICAgICAgIF0sCiAgICAgICAgIkZ1bm55MSI6IFsKICAgICAgICAgICAgIjMwLjYiLCAiMzAuNigzMSkiLCAiNDAiLCAiNTAuMSIsICI1MC4yIiwgCiAgICAgICAgICAgICI1MC41IiwgIjUwLjUoNTEpIiwgIjgwLjIoMSkiLCAiODAuMigyMSkiLCAKICAgICAgICAgICAgIjgwLjIoNDEpIiwgIjgwLjIoNjEpIgogICAgICAgIF0sCiAgICAgICAgIkZ1bm55IEVtdWxhdG9yIjogWwogICAgICAgICAgICAiNTAuNiIsICI2MC4yIiwiNjAuMigzMSkiLCIxMDAuMSIKICAgICAgICBdLAogICAgICAgICJGdW5ueSBFbXVsYXRvciAzIjogWwogICAgICAgICAgICAgIjMwIiwgIjMwLjEiLCIzMC4yIiwgIjMwLjMiLCAiNDAuNiIKICAgICAgICBdLAogICAgICAgICJGdW5ueSBFbXVsYXRvcjEiOiBbCiAgICAgICAgICAgICI1MC4zIiwiNjAuNSIsICIxMDAuMiIsICIxMDAuMyIKICAgICAgICBdCiAgICB9CgogICAgaWYgZGF0YSA9PSAiYmFja190b19ncm91cHMiOgogICAgICAgIGtleWJvYXJkID0gW1tJbmxpbmVLZXlib2FyZEJ1dHRvbihncm91cCwgY2FsbGJhY2tfZGF0YT1mImdyb3VwX3tncm91cH0iKV0gZm9yIGdyb3VwIGluIHRhZ19ncm91cHMua2V5cygpXQogICAgICAgIHJlcGx5X21hcmt1cCA9IElubGluZUtleWJvYXJkTWFya3VwKGtleWJvYXJkKQogICAgICAgIGF3YWl0IHF1ZXJ5LmVkaXRfbWVzc2FnZV90ZXh0KCJDaOG7jW4gdGFnIMSR4buDIHhlbSBkYW5oIHPDoWNoIFVJRDoiLCByZXBseV9tYXJrdXA9cmVwbHlfbWFya3VwKQogICAgICAgIHJldHVybgoKICAgIGlmIGRhdGEuc3RhcnRzd2l0aCgiZ3JvdXBfIik6CiAgICAgICAgIyBY4butIGzDvSBraGkgY2jhu41uIG5ow7NtIHRhZwogICAgICAgIGdyb3VwID0gZGF0YS5yZXBsYWNlKCJncm91cF8iLCAiIikKCiAgICAgICAgdGFncyA9IHRhZ19ncm91cHMuZ2V0KGdyb3VwLCBbXSkKICAgICAgICBpZiBub3QgdGFnczoKICAgICAgICAgICAgYXdhaXQgcXVlcnkuZWRpdF9tZXNzYWdlX3RleHQoZiLimqDvuI8gS2jDtG5nIGPDsyB0YWcgbsOgbyB0cm9uZyBuaMOzbSBge2dyb3VwfWAhIiwgcGFyc2VfbW9kZT0iTWFya2Rvd24iKQogICAgICAgICAgICByZXR1cm4KCiAgICAgICAgIyBU4bqhbyBiw6BuIHBow61tIGlubGluZSB24bubaSBjw6FjIHRhZyB0cm9uZyBuaMOzbSAoaMOgbmcgbmdhbmcsIG3hu5dpIGjDoG5nIHThu5FpIMSRYSA1IHRhZykKICAgICAgICBrZXlib2FyZCA9IFtdCiAgICAgICAgcm93ID0gW10KICAgICAgICBmb3IgaSwgdGFnIGluIGVudW1lcmF0ZSh0YWdzKToKICAgICAgICAgICAgcm93LmFwcGVuZChJbmxpbmVLZXlib2FyZEJ1dHRvbih0YWcsIGNhbGxiYWNrX2RhdGE9ZiJhZGRfe3RhZ30iKSkKICAgICAgICAgICAgaWYgKGkgKyAxKSAlIDUgPT0gMCBvciBpID09IGxlbih0YWdzKSAtIDE6ICAjIE3hu5dpIGjDoG5nIHThu5FpIMSRYSA1IHRhZwogICAgICAgICAgICAgICAga2V5Ym9hcmQuYXBwZW5kKHJvdykKICAgICAgICAgICAgICAgIHJvdyA9IFtdCiAgICAgICAgIyBUaMOqbSBuw7p0IEJhY2sKICAgICAgICBrZXlib2FyZC5hcHBlbmQoW0lubGluZUtleWJvYXJkQnV0dG9uKCLirIXvuI8gUXVheSBs4bqhaSIsIGNhbGxiYWNrX2RhdGE9ImJhY2tfdG9fZ3JvdXBzIildKQoKICAgICAgICByZXBseV9tYXJrdXAgPSBJbmxpbmVLZXlib2FyZE1hcmt1cChrZXlib2FyZCkKICAgICAgICBhd2FpdCBxdWVyeS5lZGl0X21lc3NhZ2VfdGV4dChmIkNo4buNbiB0YWcgdHJvbmcgbmjDs20gYHtncm91cH1gOiIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVwbHlfbWFya3VwPXJlcGx5X21hcmt1cCkKCiAgICBlbGlmIGRhdGEuc3RhcnRzd2l0aCgiYWRkXyIpOgogICAgICAgICMgWOG7rSBsw70ga2hpIGNo4buNbiB0YWcgxJHhu4MgdGjDqm0gVUlECiAgICAgICAgdGFnID0gZGF0YS5yZXBsYWNlKCJhZGRfIiwgIiIpCgogICAgICAgICMgQ2hlY2sgaWYgdGVtcCBkYXRhIGV4aXN0cwogICAgICAgIGlmIG5vdCBhbGwoa2V5IGluIGNvbnRleHQudXNlcl9kYXRhIGZvciBrZXkgaW4gWyd0ZW1wX3VpZCcsICd0ZW1wX3RvdGFsJywgJ3RlbXBfZGFpbHknXSk6CiAgICAgICAgICAgIGF3YWl0IHF1ZXJ5LmVkaXRfbWVzc2FnZV90ZXh0KCLimqDvuI8gROG7ryBsaeG7h3UgdOG6oW0gdGjhu51pIMSRw6MgaOG6v3QgaOG6oW4uIFZ1aSBsw7JuZyB0aOG7sWMgaGnhu4duIGzhuqFpIGzhu4duaCAvYWRkIikKICAgICAgICAgICAgcmV0dXJuCgogICAgICAgIHVpZCA9IGNvbnRleHQudXNlcl9kYXRhWyd0ZW1wX3VpZCddCiAgICAgICAgdG90YWwgPSBjb250ZXh0LnVzZXJfZGF0YVsndGVtcF90b3RhbCddCiAgICAgICAgZGFpbHkgPSBjb250ZXh0LnVzZXJfZGF0YVsndGVtcF9kYWlseSddCgogICAgICAgICMgQ2hlY2sgaWYgVUlEIGFscmVhZHkgZXhpc3RzCiAgICAgICAgY3Vyc29yLmV4ZWN1dGUoJ1NFTEVDVCB1aWQgRlJPTSB0cmFuc2FjdGlvbnMgV0hFUkUgdWlkID0gPycsICh1aWQsKSkKICAgICAgICBpZiBjdXJzb3IuZmV0Y2hvbmUoKToKICAgICAgICAgICAgYXdhaXQgcXVlcnkuZWRpdF9tZXNzYWdlX3RleHQoZiLimqDvuI8gVUlEIGB7dWlkfWAgxJHDoyB04buTbiB04bqhaSB0cm9uZyBo4buHIHRo4buRbmchIiwgcGFyc2VfbW9kZT0iTWFya2Rvd24iKQogICAgICAgICAgICByZXR1cm4KCiAgICAgICAgIyBU4bqhbyBs4buLY2ggc+G7rSBj4bqtcCBuaOG6rXQgxJHhuqd1IHRpw6puCiAgICAgICAgaW5pdGlhbF9oaXN0b3J5ID0gW3sKICAgICAgICAgICAgJ2RhdGUnOiBkYXRldGltZS5ub3coVElNRVpPTkUpLnN0cmZ0aW1lKCIlWS0lbS0lZCAlSDolTTolUyIpLAogICAgICAgICAgICAndmFsdWUnOiBkYWlseSwKICAgICAgICAgICAgJ3BlcmNlbnQnOiByb3VuZCgoZGFpbHkgLyB0b3RhbCkgKiAxMDAsIDIpCiAgICAgICAgfV0KCiAgICAgICAgIyBUaMOqbSBVSUQgdsOgbyBjxqEgc+G7nyBk4buvIGxp4buHdSB24bubaSBs4buLY2ggc+G7rSBj4bqtcCBuaOG6rXQgxJHhuqd1IHRpw6puCiAgICAgICAgY3Vyc29yLmV4ZWN1dGUoCiAgICAgICAgICAgICdJTlNFUlQgSU5UTyB0cmFuc2FjdGlvbnMgKHVpZCwgdG90YWwsIGN1cnJlbnQsIGRhaWx5LCB0YWcsIGhpc3RvcnkpIFZBTFVFUyAoPywgPywgPywgPywgPywgPyknLAogICAgICAgICAgICAodWlkLCB0b3RhbCwgZGFpbHksIGRhaWx5LCB0YWcsIGpzb24uZHVtcHMoaW5pdGlhbF9oaXN0b3J5KSkpCiAgICAgICAgY29ubi5jb21taXQoKQoKICAgICAgICAjIEdldCBkZXRhaWxlZCBpbmZvIGZvciB0aGUgbmV3IFVJRAogICAgICAgIGN1cnNvci5leGVjdXRlKCdTRUxFQ1QgKiBGUk9NIHRyYW5zYWN0aW9ucyBXSEVSRSB1aWQgPSA/JywgKHVpZCwgKSkKICAgICAgICB0cmFuc2FjdGlvbiA9IGN1cnNvci5mZXRjaG9uZSgpCiAgICAgICAgXywgdG90YWwsIGN1cnJlbnQsIGRhaWx5LCB0YWcsIGhpc3RvcnkgPSB0cmFuc2FjdGlvbgogICAgICAgIGhpc3RvcnlfbGlzdCA9IGpzb24ubG9hZHMoaGlzdG9yeSkKICAgICAgICBwZXJjZW50ID0gcm91bmQoKGN1cnJlbnQgLyB0b3RhbCkgKiAxMDAsIDIpCiAgICAgICAgcmVtYWluaW5nX2hlYXJ0cyA9IHRvdGFsIC0gY3VycmVudAoKICAgICAgICBzdWNjZXNzX21lc3NhZ2UgPSAoCiAgICAgICAgICAgIGYiYGBgXG4iCiAgICAgICAgICAgIGYi8J+SnSBCw7RuZyBn4butaSBjaMO6dCB0aMO0bmcgdGluIHbDoCBsxrB1IMO9IG5oYWEg8J+MuFxuXG4iCiAgICAgICAgICAgIGYi4pyoIFVJRDoge3VpZH1cbiIKICAgICAgICAgICAgZiLilJwgVOG7lW5nOiB7Zm9ybWF0X251bWJlcih0b3RhbCl94p2k77iPXG4iCiAgICAgICAgICAgIGYi4pScIFRpbSBoaeG7h24gY8OzOiB7Zm9ybWF0X251bWJlcihjdXJyZW50KX3inaTvuI9cbiIKICAgICAgICAgICAgZiLilJwgVGltL25nw6B5OiB7Zm9ybWF0X251bWJlcihkYWlseSl94p2k77iPXG4iCiAgICAgICAgICAgIGYi4pScIFRp4bq/biDEkeG7mToge3BlcmNlbnR9JVxuIgogICAgICAgICAgICBmIuKUnCBUYWc6IHt0YWd9XG4iCiAgICAgICAgICAgIGYi4pSUIEPDsm4gbOG6oWk6IHtmb3JtYXRfbnVtYmVyKHJlbWFpbmluZ19oZWFydHMpfeKdpO+4j1xuXG4iCiAgICAgICAgICAgIGYi8J+MnyBMxrB1IMO9IG5o4buPIHhpbmg6XG4iCiAgICAgICAgICAgIGYiLSDEkOG7q25nIHjDs2EvYmxvY2sgY2xvbmUgbmhhIPCfpbpcbiIKICAgICAgICAgICAgZiItIFRpbSBz4bq9IHh14bqldCBoaeG7h24g4bufIG3hu6VjIGNow7JtIHNhbyDwn5KrXG4iCiAgICAgICAgICAgIGYiLSBOaOG6rW4gdGltIHRyxrDhu5tjIDE1aCBow6BuZyBuZ8OgeSBnacO6cCBiw7RuZyBuaGVuIPCfjLhcbiIKICAgICAgICAgICAgZiItIEdp4bubaSB0aGnhu4d1IGLhuqFuIGLDqCBuaOG6rW4gdGjDqm0gdGltOiBodHRwczovL3d3dy5mYWNlYm9vay5jb20vc2hhcmUvcC8xSmFqSE53emExLyDwn5KVXG5cbiIKICAgICAgICAgICAgZiItIFNhdSBraGkgeG9uZyDEkcahbiBiw7RuZyBz4bq9IGLDoW8gbOG6oWkgbmdheSDhuqEgXG4iCiAgICAgICAgICAgIGYiLSBUaeG6v24gxJHhu5kgaOG6sW5nIG5nw6B5IOG7nyB0ZWxlZ3JhbSBAQm9uZ0dpYW9UaW1Cb3QgXG4iCiAgICAgICAgICAgIGYi8J+SqyBD4bqjbSDGoW4gYuG7kyDEkcOjIHRpbiB0xrDhu59uZyBCw7RuZyDwn6u2XG5gYGAiKQogICAgICAgICMgU+G7rSBk4bulbmcgZWRpdF9tZXNzYWdlX3RleHQgxJHhu4MgdGhheSDEkeG7lWkgdGluIG5o4bqvbiBjaOG7qWEgaW5saW5lIGtleWJvYXJkCiAgICAgICAgbXNnID0gYXdhaXQgcXVlcnkuZWRpdF9tZXNzYWdlX3RleHQoc3VjY2Vzc19tZXNzYWdlLCBwYXJzZV9tb2RlPSJNYXJrZG93biIpCiAgICAgICAgIyBMw6puIGzhu4tjaCB4b8OhIHRpbiBuaOG6r24gc2F1IDYwIGdpw6J5CiAgICAgICAgY29udGV4dC5qb2JfcXVldWUucnVuX29uY2UoZGVsZXRlX21lc3NhZ2UsIDYwLCBkYXRhPVttc2cubWVzc2FnZV9pZF0sIGNoYXRfaWQ9bXNnLmNoYXRfaWQpCgoKYXN5bmMgZGVmIGNoZWNrX3Byb2dyZXNzKHVwZGF0ZTogVXBkYXRlLCBjb250ZXh0OiBDb250ZXh0VHlwZXMuREVGQVVMVF9UWVBFKToKICAgIHVzZXJfaWQgPSB1cGRhdGUubWVzc2FnZS5mcm9tX3VzZXIuaWQKICAgIGFyZ3MgPSBjb250ZXh0LmFyZ3MKICAgIGZvdW5kX3VpZHMgPSBbXSAgIyBJbml0aWFsaXplIGZvdW5kX3VpZHMgbGlzdAogICAgaWYgbm90IGlzX2FkbWluKHVzZXJfaWQpOgogICAgICAgIGlmIG5vdCBhcmdzOgogICAgICAgICAgICBhd2FpdCBzZW5kX3JlcGx5X2FuZF9zY2hlZHVsZV9kZWxldGlvbigKICAgICAgICAgICAgICAgIHVwZGF0ZSwgCiAgICAgICAgICAgICAgICBjb250ZXh0LAogICAgICAgICAgICAgICAgIuKaoO+4jyBWdWkgbMOybmcgbmjhuq1wIFVJRCBj4bunYSBi4bqhbiFcblbDrSBk4bulOiBgL2NoZWNrIFVJRDEyM2AiLAogICAgICAgICAgICAgICAgZGVsYXk9MTAKICAgICAgICAgICAgKQogICAgICAgICAgICByZXR1cm4KICAgICAgICBhd2FpdCBjaGVja19zcGVjaWZpY191aWRzKHVwZGF0ZSwgY29udGV4dCwgYXJncykKICAgICAgICByZXR1cm4KICAgICMgTuG6v3Uga2jDtG5nIHBo4bqjaSBhZG1pbiB2w6Aga2jDtG5nIGPDsyBVSUQgxJHGsOG7o2MgY2jhu4kgxJHhu4tuaCAtPiB04burIGNo4buRaSAKICAgIGlmIG5vdCBpc19hZG1pbih1c2VyX2lkKSBhbmQgbm90IGFyZ3M6CiAgICAgICAgYXdhaXQgc2VuZF9yZXBseV9hbmRfc2NoZWR1bGVfZGVsZXRpb24odXBkYXRlLCBjb250ZXh0LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICLimqDvuI8gVHJ1eSBj4bqtcCBi4buLIHThu6sgY2jhu5FpISIpCiAgICAgICAgcmV0dXJuCgogICAgIyBO4bq/dSBraMO0bmcgcGjhuqNpIGFkbWluIHbDoCBjw7MgVUlEIC0+IGNobyBwaMOpcCBjaGVjawogICAgaWYgbm90IGlzX2FkbWluKHVzZXJfaWQpIGFuZCBhcmdzOgogICAgICAgIGF3YWl0IGNoZWNrX3NwZWNpZmljX3VpZHModXBkYXRlLCBjb250ZXh0LCBhcmdzKQogICAgICAgIHJldHVybgoKICAgIGFyZ3MgPSBjb250ZXh0LmFyZ3MKCiAgICBpZiBub3QgYXJnczoKICAgICAgICAjIEzhu4duaCAvY2hlY2sgLT4gbGnhu4d0IGvDqiB04bqldCBj4bqjIFVJRCAoa2jDtG5nIHThu7EgeMOzYSkKICAgICAgICBjdXJzb3IuZXhlY3V0ZSgKICAgICAgICAgICAgJ1NFTEVDVCAqIEZST00gdHJhbnNhY3Rpb25zIE9SREVSIEJZIHRhZywgKGN1cnJlbnQvdG90YWwqMTAwKScpCiAgICAgICAgdHJhbnNhY3Rpb25zID0gY3Vyc29yLmZldGNoYWxsKCkKCiAgICAgICAgaWYgbm90IHRyYW5zYWN0aW9uczoKICAgICAgICAgICAgYXdhaXQgdXBkYXRlLm1lc3NhZ2UucmVwbHlfdGV4dCgi8J+TgiBLaMO0bmcgY8OzIFVJRCBuw6BvIMSRxrDhu6NjIHRoZW8gZMO1aS4iCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKQogICAgICAgICAgICByZXR1cm4KCiAgICAgICAgY29tcGxldGVkX3VpZHMgPSBbXQogICAgICAgIGN1cnJlbnRfdGFnID0gTm9uZQogICAgICAgIGNvbXBsZXRlZF9tZXNzYWdlID0gIuKchSAqKkRhbmggc8OhY2ggVUlEIMSRw6MgaG/DoG4gdGjDoG5oOioqXG5cbiIKICAgICAgICBtZXNzYWdlID0gIvCfk4sgKipEYW5oIHPDoWNoIFVJRCB2w6AgdGnhur9uIMSR4buZOioqXG5cbiIKICAgICAgICBzZW50X21lc3NhZ2VzID0gW10KICAgICAgICBjb21wbGV0ZWRfdWlkcyA9IFtdCgogICAgICAgIGZvciB0cmFuc2FjdGlvbiBpbiB0cmFuc2FjdGlvbnM6CiAgICAgICAgICAgIHVpZCwgdG90YWwsIGN1cnJlbnQsIGRhaWx5LCB0YWcsIF8gPSB0cmFuc2FjdGlvbgogICAgICAgICAgICBwZXJjZW50ID0gcm91bmQoKGN1cnJlbnQgLyB0b3RhbCkgKiAxMDAsIDIpIGlmIHRvdGFsICE9IDAgZWxzZSAwCiAgICAgICAgICAgIHNhZmVfdWlkID0gdWlkLnJlcGxhY2UoJ18nLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICdcXF8nKS5yZXBsYWNlKCcqJywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAnXFwqJykucmVwbGFjZSgnYCcsICdcXGAnKQogICAgICAgICAgICByZW1haW5pbmcgPSB0b3RhbCAtIGN1cnJlbnQKICAgICAgICAgICAgc3RhdHVzID0gIuKchSIgaWYgcGVyY2VudCA+PSAxMDAgZWxzZSAi4p2MIgoKICAgICAgICAgICAgIyBTdGFydCBuZXcgc2VjdGlvbiBmb3IgZGlmZmVyZW50IHRhZwogICAgICAgICAgICBpZiBjdXJyZW50X3RhZyAhPSB0YWc6CiAgICAgICAgICAgICAgICBpZiBjdXJyZW50X3RhZyBpcyBub3QgTm9uZSBhbmQgbGVuKG1lc3NhZ2UpID4gMDoKICAgICAgICAgICAgICAgICAgICAjIFNlbmQgY3VycmVudCBjaHVuayBpZiBzd2l0Y2hpbmcgdG8gbmV3IHRhZwogICAgICAgICAgICAgICAgICAgIHNlbnQgPSBhd2FpdCB1cGRhdGUubWVzc2FnZS5yZXBseV90ZXh0KAogICAgICAgICAgICAgICAgICAgICAgICBtZXNzYWdlLCBwYXJzZV9tb2RlPSJNYXJrZG93biIpCiAgICAgICAgICAgICAgICAgICAgc2VudF9tZXNzYWdlcy5hcHBlbmQoc2VudC5tZXNzYWdlX2lkKQogICAgICAgICAgICAgICAgICAgIG1lc3NhZ2UgPSAiIgogICAgICAgICAgICAgICAgY3VycmVudF90YWcgPSB0YWcKICAgICAgICAgICAgICAgIG1lc3NhZ2UgKz0gZiJcbvCfj7fvuI8gKipUYWc6IHt0YWd9KipcblxuIgoKICAgICAgICAgICAgbGluZSA9ICgKICAgICAgICAgICAgICAgIGYi8J+UuSBge3NhZmVfdWlkfWBcbiIKICAgICAgICAgICAgICAgIGYi4pScIFRp4bq/biDEkeG7mToge2Zvcm1hdF9udW1iZXIoY3VycmVudCl94p2k77iPL3tmb3JtYXRfbnVtYmVyKHRvdGFsKX3inaTvuI8gKHtwZXJjZW50fSUpXG4iCiAgICAgICAgICAgICAgICBmIuKUnCBDw7JuIGzhuqFpOiB7Zm9ybWF0X251bWJlcihyZW1haW5pbmcpfeKdpO+4j1xuIgogICAgICAgICAgICAgICAgZiLilJQgVOG7sSDEkeG7mW5nOiB7Zm9ybWF0X251bWJlcihkYWlseSl94p2k77iPL25nw6B5IHtzdGF0dXN9XG5cbiIpCgogICAgICAgICAgICBpZiBsZW4obWVzc2FnZSArIGxpbmUpID4gMzgwMDogICMgQnVmZmVyIGZvciBNYXJrZG93bgogICAgICAgICAgICAgICAgc2VudCA9IGF3YWl0IHVwZGF0ZS5tZXNzYWdlLnJlcGx5X3RleHQobWVzc2FnZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhcnNlX21vZGU9Ik1hcmtkb3duIikKICAgICAgICAgICAgICAgIHNlbnRfbWVzc2FnZXMuYXBwZW5kKHNlbnQubWVzc2FnZV9pZCkKICAgICAgICAgICAgICAgIG1lc3NhZ2UgPSBmIlxu8J+Pt++4jyAqKlRhZzoge3RhZ30qKiAodGnhur9wKVxuXG57bGluZX0iCiAgICAgICAgICAgIGVsc2U6CiAgICAgICAgICAgICAgICBtZXNzYWdlICs9IGxpbmUKCiAgICAgICAgICAgIGlmIHBlcmNlbnQgPj0gMTAwOgogICAgICAgICAgICAgICAgY29tcGxldGVkX3VpZHMuYXBwZW5kKHsKICAgICAgICAgICAgICAgICAgICAidWlkIjoKICAgICAgICAgICAgICAgICAgICBzYWZlX3VpZCwKICAgICAgICAgICAgICAgICAgICAidGFnIjoKICAgICAgICAgICAgICAgICAgICB0YWcsCiAgICAgICAgICAgICAgICAgICAgImRhdGUiOgogICAgICAgICAgICAgICAgICAgIGRhdGV0aW1lLm5vdygpLnN0cmZ0aW1lKCIlWS0lbS0lZCAlSDolTTolUyIpCiAgICAgICAgICAgICAgICB9KQoKICAgICAgICAjIFNlbmQgcmVtYWluaW5nIG1lc3NhZ2UgaWYgYW55CiAgICAgICAgaWYgbWVzc2FnZToKICAgICAgICAgICAgc2VudCA9IGF3YWl0IHVwZGF0ZS5tZXNzYWdlLnJlcGx5X3RleHQobWVzc2FnZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFyc2VfbW9kZT0iTWFya2Rvd24iKQogICAgICAgICAgICBzZW50X21lc3NhZ2VzLmFwcGVuZChzZW50Lm1lc3NhZ2VfaWQpCgogICAgICAgICMgU2hvdyBjb21wbGV0ZWQgVUlEcyBpZiBhbnkKICAgICAgICBpZiBjb21wbGV0ZWRfdWlkczoKICAgICAgICAgICAgIyBEZWZpbmUgRnVubnkgZ3JvdXBzCiAgICAgICAgICAgIGZ1bm55X2dyb3VwcyA9IHsKICAgICAgICAgICAgIkZ1bm55IjogWwogICAgICAgICAgICAgICAgICAgICIzMC41IiwgIjMwLjUoMzEpIiwgIjQwLjEiLCAiNDAuNSIsICI2MCIsIAogICAgICAgICAgICAgICAgICAgICI4MCgxKSIsICI4MCgyMSkiLCAiODAoNDEpIiwgIjgwKDYxKSIKICAgICAgICAgICAgICAgIF0sCiAgICAgICAgICAgICAgICAiRnVubnkxIjogWwogICAgICAgICAgICAgICAgICAgICIzMC42IiwgIjMwLjYoMzEpIiwgIjQwIiwgIjUwLjEiLCAiNTAuMiIsIAogICAgICAgICAgICAgICAgICAgICI1MC41IiwgIjUwLjUoNTEpIiwgIjgwLjIoMSkiLCAiODAuMigyMSkiLCAKICAgICAgICAgICAgICAgICAgICAiODAuMig0MSkiLCAiODAuMig2MSkiCiAgICAgICAgICAgICAgICBdLAogICAgICAgICAgICAgICAgIkZ1bm55IEVtdWxhdG9yIjogWwogICAgICAgICAgICAgICAgICAgICI1MC42IiwgIjYwLjIiLCI2MC4yKDMxKSIsIjEwMC4xIgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJGdW5ueSBFbXVsYXRvciAzIjogWwogICAgICAgICAgICAgICAgICAgICAiMzAiLCAiMzAuMSIsIjMwLjIiLCAiMzAuMyIsICI0MC42IgogICAgICAgICAgICAgICAgXSwKICAgICAgICAgICAgICAgICJGdW5ueSBFbXVsYXRvcjEiOiBbCiAgICAgICAgICAgICAgICAgICAgIjUwLjMiLCI2MC41IiwgIjEwMC4yIiwgIjEwMC4zIgogICAgICAgICAgICAgICAgXQogICAgICAgICAgICB9CgogICAgICAgICAgICAjIEdyb3VwIGJ5IEZ1bm55IGNhdGVnb3JpZXMgZmlyc3QKICAgICAgICAgICAgY29tcGxldGVkX2J5X2Z1bm55ID0ge2dyb3VwOiBbXSBmb3IgZ3JvdXAgaW4gZnVubnlfZ3JvdXBzLmtleXMoKX0KICAgICAgICAgICAgY29tcGxldGVkX290aGVyID0gW10KCiAgICAgICAgICAgIGZvciB1aWRfaW5mbyBpbiBjb21wbGV0ZWRfdWlkczoKICAgICAgICAgICAgICAgIHRhZyA9IHVpZF9pbmZvWyJ0YWciXQogICAgICAgICAgICAgICAgdWlkID0gdWlkX2luZm9bInVpZCJdCiAgICAgICAgICAgICAgICBmb3VuZCA9IEZhbHNlCiAgICAgICAgICAgICAgICBmb3IgZ3JvdXAsIHRhZ3MgaW4gZnVubnlfZ3JvdXBzLml0ZW1zKCk6CiAgICAgICAgICAgICAgICAgICAgaWYgdGFnIGluIHRhZ3M6CiAgICAgICAgICAgICAgICAgICAgICAgIGNvbXBsZXRlZF9ieV9mdW5ueVtncm91cF0uYXBwZW5kKCh1aWQsIHRhZykpCiAgICAgICAgICAgICAgICAgICAgICAgIGZvdW5kID0gVHJ1ZQogICAgICAgICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAgICAgaWYgbm90IGZvdW5kOgogICAgICAgICAgICAgICAgICAgIGNvbXBsZXRlZF9vdGhlci5hcHBlbmQoKHVpZCwgdGFnKSkKCiAgICAgICAgICAgIGNvbXBsZXRlZF9tZXNzYWdlID0gIuKchSAqKkRhbmggc8OhY2ggVUlEIMSRw6MgaG/DoG4gdGjDoG5oOioqXG5cbiIKCiAgICAgICAgICAgICMgTGlzdCBieSBGdW5ueSBncm91cHMKICAgICAgICAgICAgZm9yIGdyb3VwLCB1aWRzIGluIGNvbXBsZXRlZF9ieV9mdW5ueS5pdGVtcygpOgogICAgICAgICAgICAgICAgaWYgdWlkczoKICAgICAgICAgICAgICAgICAgICBjb21wbGV0ZWRfbWVzc2FnZSArPSBmIvCfjq4gKip7Z3JvdXB9KipcbiIKICAgICAgICAgICAgICAgICAgICBmb3IgdWlkLCB0YWcgaW4gdWlkczoKICAgICAgICAgICAgICAgICAgICAgICAgY29tcGxldGVkX21lc3NhZ2UgKz0gZiLilJQgYHt1aWR9YCAoe3RhZ30pXG4iCiAgICAgICAgICAgICAgICAgICAgY29tcGxldGVkX21lc3NhZ2UgKz0gIlxuIgoKICAgICAgICAgICAgIyBMaXN0IG90aGVyIHRhZ3MKICAgICAgICAgICAgaWYgY29tcGxldGVkX290aGVyOgogICAgICAgICAgICAgICAgY29tcGxldGVkX21lc3NhZ2UgKz0gIvCfj7fvuI8gKipLaMOhYyoqXG4iCiAgICAgICAgICAgICAgICBmb3IgdWlkLCB0YWcgaW4gY29tcGxldGVkX290aGVyOgogICAgICAgICAgICAgICAgICAgIGNvbXBsZXRlZF9tZXNzYWdlICs9IGYi4pSUIGB7dWlkfWAgKHt0YWd9KVxuIgogICAgICAgICAgICAgICAgY29tcGxldGVkX21lc3NhZ2UgKz0gIlxuIgoKICAgICAgICAgICAgc2VudCA9IGF3YWl0IHVwZGF0ZS5tZXNzYWdlLnJlcGx5X3RleHQoY29tcGxldGVkX21lc3NhZ2UsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhcnNlX21vZGU9Ik1hcmtkb3duIikKICAgICAgICAgICAgc2VudF9tZXNzYWdlcy5hcHBlbmQoc2VudC5tZXNzYWdlX2lkKQoKICAgICAgICAjIEFkZCBzdW1tYXJ5IHdpdGggY3VycmVudCBkYXRlCiAgICAgICAgY3VycmVudF9kYXRlID0gZGF0ZXRpbWUubm93KFRJTUVaT05FKS5zdHJmdGltZSgiJWQvJW0vJVkiKQogICAgICAgIHRvdGFsX3VpZHMgPSBsZW4odHJhbnNhY3Rpb25zKQogICAgICAgIGNvbXBsZXRlZF9jb3VudCA9IGxlbihjb21wbGV0ZWRfdWlkcykKICAgICAgICBpbl9wcm9ncmVzcyA9IHRvdGFsX3VpZHMgLSBjb21wbGV0ZWRfY291bnQKICAgICAgICBzdW1tYXJ5ID0gKGYi8J+TiiAqKlThu5VuZyBr4bq/dDoge2N1cnJlbnRfZGF0ZX0qKlxuIgogICAgICAgICAgICAgICAgICAgZiLilJwgVOG7lW5nIHPhu5EgVUlEOiB7dG90YWxfdWlkc31cbiIKICAgICAgICAgICAgICAgICAgIGYi4pScIMSQw6MgaG/DoG4gdGjDoG5oOiB7Y29tcGxldGVkX2NvdW50fVxuIgogICAgICAgICAgICAgICAgICAgZiLilJQgxJBhbmcgdGjhu7FjIGhp4buHbjoge2luX3Byb2dyZXNzfVxuIikKICAgICAgICBzZW50ID0gYXdhaXQgdXBkYXRlLm1lc3NhZ2UucmVwbHlfdGV4dChzdW1tYXJ5LCBwYXJzZV9tb2RlPSJNYXJrZG93biIpCiAgICAgICAgc2VudF9tZXNzYWdlcy5hcHBlbmQoc2VudC5tZXNzYWdlX2lkKQoKICAgICAgICAjIFNjaGVkdWxlIGRlbGV0aW9uIGFmdGVyIDYwIG1pbnV0ZXMKICAgICAgICBjb250ZXh0LmpvYl9xdWV1ZS5ydW5fb25jZShkZWxldGVfbWVzc2FnZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAzNjAwLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGRhdGE9W3VwZGF0ZS5tZXNzYWdlLm1lc3NhZ2VfaWRdICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZW50X21lc3NhZ2VzLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNoYXRfaWQ9dXBkYXRlLmVmZmVjdGl2ZV9jaGF0LmlkKQoKICAgIGVsc2U6CiAgICAgICAgIyBM4buHbmggL2NoZWNrIFtVSUQxXSBbVUlEMl0gW1VJRDNdLi4uIC0+IHhlbSBjaGkgdGnhur90IG5oaeG7gXUgVUlECiAgICAgICAgbm90X2ZvdW5kX3VpZHMgPSBbXQogICAgICAgIGZvdW5kX3VpZHMgPSBbXQogICAgICAgIG1lc3NhZ2VzID0gW10KCiAgICAgICAgZm9yIHVpZCBpbiBhcmdzOgogICAgICAgICAgICBjdXJzb3IuZXhlY3V0ZSgnU0VMRUNUICogRlJPTSB0cmFuc2FjdGlvbnMgV0hFUkUgdWlkID0gPycsICh1aWQsKSkKICAgICAgICAgICAgdHJhbnNhY3Rpb24gPSBjdXJzb3IuZmV0Y2hvbmUoKQoKICAgICAgICAgICAgaWYgbm90IHRyYW5zYWN0aW9uOgogICAgICAgICAgICAgICAgbm90X2ZvdW5kX3VpZHMuYXBwZW5kKHVpZCkKICAgICAgICAgICAgICAgIGNvbnRpbnVlCgogICAgICAgICAgICBfLCB0b3RhbCwgY3VycmVudCwgZGFpbHksIHRhZywgaGlzdG9yeSA9IHRyYW5zYWN0aW9uCiAgICAgICAgICAgIGhpc3RvcnlfbGlzdCA9IGpzb24ubG9hZHMoaGlzdG9yeSkgaWYgaGlzdG9yeSBlbHNlIFtdCiAgICAgICAgICAgIHBlcmNlbnQgPSByb3VuZCgoY3VycmVudCAvIHRvdGFsKSAqIDEwMCwgMikKICAgICAgICAgICAgc2FmZV91aWQgPSB1aWQucmVwbGFjZSgnXycsICdcXF8nKS5yZXBsYWNlKCcqJywgJ1xcKicpLnJlcGxhY2UoJ2AnLCAnXFxgJykKICAgICAgICAgICAgcmVtYWluaW5nX2hlYXJ0cyA9IHRvdGFsIC0gY3VycmVudAoKICAgICAgICAgICAgZm91bmRfdWlkcy5hcHBlbmQodWlkKQogICAgICAgICAgICBjb21wbGV0aW9uX3N0YXR1cyA9ICLwn46JIENow7pjIG3hu6tuZyBi4buTIGl1IMSRw6MgaG/DoG4gdGjDoG5oIHRpbSByw7lpIG7DqCEg8J+Mn1xu8J+SlSBD4bqjbSDGoW4gYuG7kyDEkcOjIHRpbiB0xrDhu59uZyB2w6Ag4bunbmcgaOG7mSBCw7RuZyBuaGEg8J+lsFxu8J+MuCBO4bq/dSDEkcaw4bujYywgYuG7kyDEkeG7gyBs4bqhaSAxIGZlZWRiYWNrIGNobyBCw7RuZyBuaMOpOiBodHRwczovL3d3dy5mYWNlYm9vay5jb20vc2hhcmUvcC8xOE5WazROc21SLyDwn5KdXG5cbiIgaWYgcGVyY2VudCA+PSAxMDAgZWxzZSAiIgogICAgICAgICAgICBtZXNzYWdlID0gKAogICAgICAgICAgICAgICAgIvCfjoAgSGVsdSBi4buTIGl1IGPhu6dhIGLDtG5nLCBiw7RuZyB4aW4gZ+G7rWkgdGnhur9uIMSR4buZIGdpYW8gdGltIG7DoCDwn5KdXG5cbiIgKyBjb21wbGV0aW9uX3N0YXR1cyArCiAgICAgICAgICAgICAgICBmIuKcqCBVSUQgIGPhu6dhIGLhu5M6IGB7c2FmZV91aWR9YFxuIgogICAgICAgICAgICAgICAgZiLilJwgVOG7lW5nIDoge2Zvcm1hdF9udW1iZXIodG90YWwpfeKdpO+4j1xuIgogICAgICAgICAgICAgICAgZiLilJwgVGltIGhp4buHbiB04bqhaSBuw6g6IHtmb3JtYXRfbnVtYmVyKGN1cnJlbnQpfeKdpO+4j1xuIgogICAgICAgICAgICAgICAgZiLilJwgVGltIG3hu5dpIG5nw6B5IOG6oToge2Zvcm1hdF9udW1iZXIoZGFpbHkpfeKdpO+4j1xuIgogICAgICAgICAgICAgICAgZiLilJwgVGnhur9uIMSR4buZIGPhu6dhIGLhu5M6IHtwZXJjZW50fSVcbiIKICAgICAgICAgICAgICAgIGYi4pScIFRhZyA6IHt0YWd9XG4iCiAgICAgICAgICAgICAgICBmIuKUlCBUaW0gY8OybiBs4bqhaSBuw6g6IHtmb3JtYXRfbnVtYmVyKHJlbWFpbmluZ19oZWFydHMpfeKdpO+4j1xuXG4iCiAgICAgICAgICAgICkKCiAgICAgICAgICAgIGlmIGhpc3RvcnlfbGlzdDoKICAgICAgICAgICAgICAgIG1lc3NhZ2UgKz0gIvCfkowgKipCw7RuZyBi4bqvdCDEkeG6p3UgZ+G7rWkgdGltIGNobyBi4buTIHbDoG8gbMO6YzoqKlxuIgogICAgICAgICAgICAgICAgY3VycmVudF90aW1lID0gZGF0ZXRpbWUubm93KFRJTUVaT05FKS5zdHJmdGltZSgiJVktJW0tJWQgJUg6JU06JVMiKQoKICAgICAgICAgICAgICAgIGZvciBpZHgsIGl0ZW0gaW4gZW51bWVyYXRlKHJldmVyc2VkKGhpc3RvcnlfbGlzdFstNTA6XSkpOgogICAgICAgICAgICAgICAgICAgIHZhbHVlID0gaXRlbVsndmFsdWUnXQogICAgICAgICAgICAgICAgICAgIG9sZF9wZXJjZW50ID0gaXRlbVsncGVyY2VudCddCiAgICAgICAgICAgICAgICAgICAgZGF0ZSA9IGl0ZW1bJ2RhdGUnXQoKICAgICAgICAgICAgICAgICAgICAjIFTDrW5oIHRvw6FuIG5nw6B5IGjDtG0gc2F1CiAgICAgICAgICAgICAgICAgICAgbmV4dF9kYXkgPSAoZGF0ZXRpbWUuc3RycHRpbWUoZGF0ZSwgIiVZLSVtLSVkICVIOiVNOiVTIikgKyB0aW1lZGVsdGEoZGF5cz0xKSkuc3RyZnRpbWUoIiVZLSVtLSVkIikKCiAgICAgICAgICAgICAgICAgICAgaWYgaWR4ID09IDA6ICAjIENo4buJIMOhcCBk4bulbmcgY2hvIGzhuqduIGPhuq1wIG5o4bqtdCBn4bqnbiBuaOG6pXQKICAgICAgICAgICAgICAgICAgICAgICAgIyBLaeG7g20gdHJhIHhlbSB0aOG7nWkgZ2lhbiB0aOG7sWMgdOG6vyDEkcOjIHF1YSBjaMawYQogICAgICAgICAgICAgICAgICAgICAgICBub3cgPSBkYXRldGltZS5ub3coVElNRVpPTkUpCiAgICAgICAgICAgICAgICAgICAgICAgIG5leHRfZGF5X3RpbWUgPSBkYXRldGltZS5zdHJwdGltZShuZXh0X2RheSwgIiVZLSVtLSVkIikucmVwbGFjZShob3VyPTYsIG1pbnV0ZT0wLCBzZWNvbmQ9MCwgdHppbmZvPVRJTUVaT05FKQogICAgICAgICAgICAgICAgICAgICAgICBpZiBub3cgPj0gbmV4dF9kYXlfdGltZToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICMgTuG6v3UgxJHDoyBxdWEgNmggc8OhbmcgbmfDoHkgaMO0bSBzYXUsIGhp4buDbiB0aOG7iyBwaOG6p24gdHLEg20gdGjhu7FjIHThur8KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXR1cyA9IGYiKHtvbGRfcGVyY2VudH0lKSIKICAgICAgICAgICAgICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgICAgICAgICAgICAgICMgTuG6v3UgY2jGsGEgcXVhLCBoaeG7g24gdGjhu4sgZOG7sSDEkW/DoW4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHN0YXR1cyA9ICLwn6e4KELDtG5nIMSRYW5nIGfhu61pIHRpbSBjaG8gYuG7kyBuaOG7mywgNmggc8OhbmcgbWFpIHRpbSBz4bq9IHh14bqldCBoaeG7h24g4bufIGNow7JtIHNhbyBj4bunYSBi4buTIGl1IPCfjIgpIgogICAgICAgICAgICAgICAgICAgICAgICAgICAgbWVzc2FnZSArPSAi8J+MuCBTYXUgNmggc8OhbmcgbuG6v3UgYuG7kyBraMO0bmcgdGjhuqV5IHRpbSDhu58gY2jDsm0gc2FvIHRow6wgbmjhuq9uIGzhuqFpIGNobyBCw7RuZyBiaeG6v3QgbGnhu4FuIG5ow7Mg8J+OgFxuIiAgICAgICAKICAgICAgICAgICAgICAgICAgICBlbHNlOgogICAgICAgICAgICAgICAgICAgICAgICBzdGF0dXMgPSBmIih7b2xkX3BlcmNlbnR9JSkiCgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIyBIaeG7g24gdGjhu4sgxJHDum5nIMSR4buLbmggZOG6oW5nIHbhu5tpIGljb24gZOG7hSB0aMawxqFuZyBoxqFuCiAgICAgICAgICAgICAgICAgICAgbWVzc2FnZSArPSBmIuKUnCBge2RhdGV9YDogK3tmb3JtYXRfbnVtYmVyKHZhbHVlKX3wn5KdIHtzdGF0dXN9XG4iCgogICAgICAgICAgICAgICAgbWVzc2FnZSArPSAiXG4iCgogICAgICAgICAgICBtZXNzYWdlICs9ICLwn4y3IE7hur91IGPDsyBzYWkgc8OzdCBnw6wgYuG7kyBuaOG6r24gbOG6oWkgY2hvIELDtG5nIGJp4bq/dCBsaeG7gW4gbmjDsywgQsO0bmcgc+G6vSBjaGVjayBs4bqhaSBuZ2F5IPCfpbrwn5KVXG4iCgogICAgICAgICAgICBtZXNzYWdlcy5hcHBlbmQobWVzc2FnZSkKCiAgICAgICAgaWYgbm90IGZvdW5kX3VpZHM6CiAgICAgICAgICAgIGF3YWl0IHNlbmRfcmVwbHlfYW5kX3NjaGVkdWxlX2RlbGV0aW9uKHVwZGF0ZSwgY29udGV4dCwgCiAgICAgICAgICAgICAgICAi4pqg77iPIEtow7RuZyB0w6xtIHRo4bqleSBVSUQgbsOgbyEiKQogICAgICAgICAgICByZXR1cm4KCiAgICAgICAgIyBH4butaSB0aMO0bmcgYsOhbyB24buBIGPDoWMgVUlEIGtow7RuZyB04buTbiB04bqhaSAobuG6v3UgY8OzKQogICAgICAgIGlmIG5vdF9mb3VuZF91aWRzOgogICAgICAgICAgICBub3RfZm91bmRfbWVzc2FnZSA9ICLimqDvuI8gKipDw6FjIFVJRCBraMO0bmcgdOG7k24gdOG6oWk6KipcbiIgKyBcCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICJcbiIuam9pbihbZiLilJQgYHt1aWR9YCIgZm9yIHVpZCBpbiBub3RfZm91bmRfdWlkc10pCiAgICAgICAgICAgIHNlbnQgPSBhd2FpdCB1cGRhdGUubWVzc2FnZS5yZXBseV90ZXh0KG5vdF9mb3VuZF9tZXNzYWdlLCBwYXJzZV9tb2RlPSJNYXJrZG93biIpCiAgICAgICAgICAgIHNlbnRfbWVzc2FnZXMgPSBbdXBkYXRlLm1lc3NhZ2UubWVzc2FnZV9pZCwgc2VudC5tZXNzYWdlX2lkXQogICAgICAgICAgICBjb250ZXh0LmpvYl9xdWV1ZS5ydW5fb25jZShkZWxldGVfbWVzc2FnZSwgMzAsIGRhdGE9c2VudF9tZXNzYWdlcywgY2hhdF9pZD11cGRhdGUuZWZmZWN0aXZlX2NoYXQuaWQpCgogICAgICAgICMgR+G7rWkgdGjDtG5nIHRpbiBjaG8gdOG7q25nIFVJRCDEkcaw4bujYyB0w6xtIHRo4bqleQogICAgICAgIHNlbnRfbWVzc2FnZXMgPSBbXQogICAgICAgIGZvciBtZXNzYWdlIGluIG1lc3NhZ2VzOgogICAgICAgICAgICBmb3IgcGFydCBpbiBzcGxpdF9tZXNzYWdlKG1lc3NhZ2UpOgogICAgICAgICAgICAgICAgc2VudCA9IGF3YWl0IHVwZGF0ZS5tZXNzYWdlLnJlcGx5X3RleHQocGFydCwgcGFyc2VfbW9kZT0iTWFya2Rvd24iKQogICAgICAgICAgICAgICAgc2VudF9tZXNzYWdlcy5hcHBlbmQoc2VudC5tZXNzYWdlX2lkKQoKICAgICAgICBjb250ZXh0LmpvYl9xdWV1ZS5ydW5fb25jZShkZWxldGVfbWVzc2FnZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAzMCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhPVt1cGRhdGUubWVzc2FnZS5tZXNzYWdlX2lkXSArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VudF9tZXNzYWdlcywKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjaGF0X2lkPXVwZGF0ZS5lZmZlY3RpdmVfY2hhdC5pZCkKCgphc3luYyBkZWYgZGVsX3VpZCh1cGRhdGU6IFVwZGF0ZSwgY29udGV4dDogQ29udGV4dFR5cGVzLkRFRkFVTFRfVFlQRSk6CiAgICBpZiBub3QgaXNfYWRtaW4odXBkYXRlLm1lc3NhZ2UuZnJvbV91c2VyLmlkKToKICAgICAgICBhd2FpdCBzZW5kX3JlcGx5X2FuZF9zY2hlZHVsZV9kZWxldGlvbih1cGRhdGUsIGNvbnRleHQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIuKaoO+4jyBUcnV5IGPhuq1wIGLhu4sgdOG7qyBjaOG7kWkhIikKICAgICAgICByZXR1cm4KICAgIGFyZ3MgPSBjb250ZXh0LmFyZ3MKICAgIGlmIG5vdCBhcmdzOgogICAgICAgIGF3YWl0IHNlbmRfcmVwbHlfYW5kX3NjaGVkdWxlX2RlbGV0aW9uKAogICAgICAgICAgICB1cGRhdGUsIGNvbnRleHQsICLimqDvuI8gKipDw7ogcGjDoXA6KipcbmAvZGVsIFtVSUQxXSBbVUlEMl0gW1VJRDNdLi4uYFxuVsOtIGThu6U6IGAvZGVsIFVJRDEyMyBVSUQ0NTZgIikKICAgICAgICByZXR1cm4KCiAgICBkZWxldGVkX3VpZHMgPSBbXQogICAgbm90X2ZvdW5kX3VpZHMgPSBbXQoKICAgIGZvciB1aWQgaW4gYXJnczoKICAgICAgICBjdXJzb3IuZXhlY3V0ZSgnREVMRVRFIEZST00gdHJhbnNhY3Rpb25zIFdIRVJFIHVpZCA9ID8nLCAodWlkLCApKQogICAgICAgIGlmIGN1cnNvci5yb3djb3VudCA+IDA6CiAgICAgICAgICAgIGRlbGV0ZWRfdWlkcy5hcHBlbmQodWlkKQogICAgICAgIGVsc2U6CiAgICAgICAgICAgIG5vdF9mb3VuZF91aWRzLmFwcGVuZCh1aWQpCgogICAgY29ubi5jb21taXQoKQoKICAgIG1lc3NhZ2UgPSAiIgogICAgaWYgZGVsZXRlZF91aWRzOgogICAgICAgIG1lc3NhZ2UgKz0gZiLinIUgxJDDoyB4w7NhIHRow6BuaCBjw7RuZyB7bGVuKGRlbGV0ZWRfdWlkcyl9IFVJRDpcbiIKICAgICAgICBmb3IgdWlkIGluIGRlbGV0ZWRfdWlkczoKICAgICAgICAgICAgbWVzc2FnZSArPSBmIuKUlCBge3VpZH1gXG4iCgogICAgaWYgbm90X2ZvdW5kX3VpZHM6CiAgICAgICAgaWYgbWVzc2FnZToKICAgICAgICAgICAgbWVzc2FnZSArPSAiXG4iCiAgICAgICAgbWVzc2FnZSArPSBmIuKaoO+4jyBLaMO0bmcgdMOsbSB0aOG6pXkge2xlbihub3RfZm91bmRfdWlkcyl9IFVJRDpcbiIKICAgICAgICBmb3IgdWlkIGluIG5vdF9mb3VuZF91aWRzOgogICAgICAgICAgICBtZXNzYWdlICs9IGYi4pSUIGB7dWlkfWBcbiIKCiAgICByZXNwb25zZV9tZXNzYWdlID0gYXdhaXQgdXBkYXRlLm1lc3NhZ2UucmVwbHlfdGV4dChtZXNzYWdlLCBwYXJzZV9tb2RlPSJNYXJrZG93biIpCiAgICBjb250ZXh0LmpvYl9xdWV1ZS5ydW5fb25jZSgKICAgICAgICBkZWxldGVfbWVzc2FnZSwKICAgICAgICAzMCwKICAgICAgICBkYXRhPVt1cGRhdGUubWVzc2FnZS5tZXNzYWdlX2lkLCByZXNwb25zZV9tZXNzYWdlLm1lc3NhZ2VfaWRdLAogICAgICAgIGNoYXRfaWQ9dXBkYXRlLmVmZmVjdGl2ZV9jaGF0LmlkKQoKCmFzeW5jIGRlZiBkZWxldGVfbWVzc2FnZShjb250ZXh0OiBDb250ZXh0VHlwZXMuREVGQVVMVF9UWVBFKToKICAgIGpvYiA9IGNvbnRleHQuam9iCiAgICBtZXNzYWdlX2lkcyA9IGpvYi5kYXRhCiAgICBjaGF0X2lkID0gam9iLmNoYXRfaWQKICAgIGZvciBtZXNzYWdlX2lkIGluIG1lc3NhZ2VfaWRzOgogICAgICAgIHRyeToKICAgICAgICAgICAgYXdhaXQgY29udGV4dC5ib3QuZGVsZXRlX21lc3NhZ2UoY2hhdF9pZD1jaGF0X2lkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBtZXNzYWdlX2lkPW1lc3NhZ2VfaWQpCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbjoKICAgICAgICAgICAgIyBTaWxlbnRseSBpZ25vcmUgaWYgbWVzc2FnZSBpcyBhbHJlYWR5IGRlbGV0ZWQgb3IgdG9vIG9sZAogICAgICAgICAgICBjb250aW51ZQoKCmFzeW5jIGRlZiB0b2dnbGVfYXV0byh1cGRhdGU6IFVwZGF0ZSwgY29udGV4dDogQ29udGV4dFR5cGVzLkRFRkFVTFRfVFlQRSk6CiAgICBpZiBub3QgaXNfYWRtaW4odXBkYXRlLm1lc3NhZ2UuZnJvbV91c2VyLmlkKToKICAgICAgICBhd2FpdCBzZW5kX3JlcGx5X2FuZF9zY2hlZHVsZV9kZWxldGlvbih1cGRhdGUsIGNvbnRleHQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIuKaoO+4jyBUcnV5IGPhuq1wIGLhu4sgdOG7qyBjaOG7kWkhIikKICAgICAgICByZXR1cm4KICAgIGN1cnJlbnRfc3RhdHVzID0gZ2V0X2F1dG9fdXBkYXRlX3N0YXR1cygpCiAgICBuZXdfc3RhdHVzID0gbm90IGN1cnJlbnRfc3RhdHVzCiAgICBzZXRfYXV0b191cGRhdGVfc3RhdHVzKG5ld19zdGF0dXMpCiAgICBzdGF0dXMgPSAi8J+foiBC4bqsVCIgaWYgbmV3X3N0YXR1cyBlbHNlICLwn5S0IFThuq5UIgogICAgcmVzcG9uc2UgPSBhd2FpdCB1cGRhdGUubWVzc2FnZS5yZXBseV90ZXh0KGYi4pyFIENo4bq/IMSR4buZIHThu7EgxJHhu5luZzoge3N0YXR1c30iKQogICAgY29udGV4dC5qb2JfcXVldWUucnVuX29uY2UoCiAgICAgICAgZGVsZXRlX21lc3NhZ2UsCiAgICAgICAgMzAsCiAgICAgICAgZGF0YT1bdXBkYXRlLm1lc3NhZ2UubWVzc2FnZV9pZCwgcmVzcG9uc2UubWVzc2FnZV9pZF0sCiAgICAgICAgY2hhdF9pZD11cGRhdGUuZWZmZWN0aXZlX2NoYXQuaWQpCgoKYXN5bmMgZGVmIGxpc3RfdWlkc19ieV90YWcodXBkYXRlOiBVcGRhdGUsIGNvbnRleHQ6IENvbnRleHRUeXBlcy5ERUZBVUxUX1RZUEUpOgogICAgaWYgbm90IGlzX2FkbWluKHVwZGF0ZS5tZXNzYWdlLmZyb21fdXNlci5pZCk6CiAgICAgICAgYXdhaXQgc2VuZF9yZXBseV9hbmRfc2NoZWR1bGVfZGVsZXRpb24odXBkYXRlLCBjb250ZXh0LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICLimqDvuI8gVHJ1eSBj4bqtcCBi4buLIHThu6sgY2jhu5FpISIpCiAgICAgICAgcmV0dXJuCgogICAgIyBEZWZpbmUgdGFnIGdyb3VwcwogICAgdGFnX2dyb3Vwc19kZWZpbml0aW9uID0gewogICAgIkZ1bm55IjogWwogICAgICAgICAgICAiMzAuNSIsICIzMC41KDMxKSIsICI0MC4xIiwgIjQwLjUiLCAiNjAiLCAKICAgICAgICAgICAgIjgwKDEpIiwgIjgwKDIxKSIsICI4MCg0MSkiLCAiODAoNjEpIgogICAgICAgIF0sCiAgICAgICAgIkZ1bm55MSI6IFsKICAgICAgICAgICAgIjMwLjYiLCAiMzAuNigzMSkiLCAiNDAiLCAiNTAuMSIsICI1MC4yIiwgCiAgICAgICAgICAgICI1MC41IiwgIjUwLjUoNTEpIiwgIjgwLjIoMSkiLCAiODAuMigyMSkiLCAKICAgICAgICAgICAgIjgwLjIoNDEpIiwgIjgwLjIoNjEpIgogICAgICAgIF0sCiAgICAgICAgIkZ1bm55IEVtdWxhdG9yIjogWwogICAgICAgICAgICAiNTAuNiIsICI2MC4yIiwiNjAuMigzMSkiLCIxMDAuMSIKICAgICAgICBdLAogICAgICAgICJGdW5ueSBFbXVsYXRvciAzIjogWwogICAgICAgICAgICAiMzAiLCAiMzAuMSIsIjMwLjIiLCAiMzAuMyIsICI0MC42IgogICAgICAgIF0sCiAgICAgICAgIkZ1bm55IEVtdWxhdG9yMSI6IFsKICAgICAgICAgICAgIjUwLjMiLCI2MC41IiwgIjEwMC4yIiwgIjEwMC4zIgogICAgICAgIF0KICAgIH0KCiAgICAjIEdldCBhbGwgdHJhbnNhY3Rpb25zIGZyb20gZGF0YWJhc2UKICAgIGN1cnNvci5leGVjdXRlKCdTRUxFQ1QgdWlkLCB0YWcsIGN1cnJlbnQsIHRvdGFsIEZST00gdHJhbnNhY3Rpb25zIE9SREVSIEJZIHRhZywgdWlkJykKICAgIHRyYW5zYWN0aW9ucyA9IGN1cnNvci5mZXRjaGFsbCgpCgogICAgaWYgbm90IHRyYW5zYWN0aW9uczoKICAgICAgICBhd2FpdCB1cGRhdGUubWVzc2FnZS5yZXBseV90ZXh0KCLwn5OCIEtow7RuZyBjw7MgVUlEIG7DoG8gxJHGsOG7o2MgdGhlbyBkw7VpLiIpCiAgICAgICAgcmV0dXJuCgogICAgIyBHcm91cCB0cmFuc2FjdGlvbnMgYnkgZGVmaW5lZCBncm91cHMgQU5EIGJ5IHRhZyB3aXRoaW4gZWFjaCBncm91cAogICAgZ3JvdXBlZF9kYXRhID0ge2dyb3VwOiB7fSBmb3IgZ3JvdXAgaW4gdGFnX2dyb3Vwc19kZWZpbml0aW9uLmtleXMoKX0KICAgIHVzZWRfdGFncyA9IHNldCgpCiAgICBvdGhlcl90YWdzID0ge30gICMgRm9yIHRhZ3Mgbm90IGluIGFueSBkZWZpbmVkIGdyb3VwCgogICAgIyBUcmFjayBhbGwgdGFncyBiZWluZyB1c2VkCiAgICBmb3IgdWlkLCB0YWcsIGN1cnJlbnQsIHRvdGFsIGluIHRyYW5zYWN0aW9uczoKICAgICAgICB1c2VkX3RhZ3MuYWRkKHRhZykKICAgICAgICBwZXJjZW50ID0gcm91bmQoKGN1cnJlbnQgLyB0b3RhbCkgKiAxMDAsIDIpIGlmIHRvdGFsICE9IDAgZWxzZSAwCiAgICAgICAgZm91bmQgPSBGYWxzZQogICAgICAgIGZvciBncm91cCwgdGFncyBpbiB0YWdfZ3JvdXBzX2RlZmluaXRpb24uaXRlbXMoKToKICAgICAgICAgICAgaWYgdGFnIGluIHRhZ3M6CiAgICAgICAgICAgICAgICAjIEdyb3VwIGJ5IHRhZyB3aXRoaW4gZWFjaCBncm91cAogICAgICAgICAgICAgICAgaWYgdGFnIG5vdCBpbiBncm91cGVkX2RhdGFbZ3JvdXBdOgogICAgICAgICAgICAgICAgICAgIGdyb3VwZWRfZGF0YVtncm91cF1bdGFnXSA9IFtdCiAgICAgICAgICAgICAgICBncm91cGVkX2RhdGFbZ3JvdXBdW3RhZ10uYXBwZW5kKCh1aWQsIHBlcmNlbnQpKQogICAgICAgICAgICAgICAgZm91bmQgPSBUcnVlCiAgICAgICAgICAgICAgICBicmVhawogICAgICAgIGlmIG5vdCBmb3VuZDoKICAgICAgICAgICAgIyBHcm91cCBieSB0YWcgd2l0aGluICJvdGhlciIgY2F0ZWdvcnkKICAgICAgICAgICAgaWYgdGFnIG5vdCBpbiBvdGhlcl90YWdzOgogICAgICAgICAgICAgICAgb3RoZXJfdGFnc1t0YWddID0gW10KICAgICAgICAgICAgb3RoZXJfdGFnc1t0YWddLmFwcGVuZCgodWlkLCBwZXJjZW50KSkKCiAgICAjIEZpbmQgdW51c2VkIHRhZ3MKICAgIHVudXNlZF90YWdzID0ge30KICAgIGZvciBncm91cCwgdGFncyBpbiB0YWdfZ3JvdXBzX2RlZmluaXRpb24uaXRlbXMoKToKICAgICAgICB1bnVzZWQgPSBbdGFnIGZvciB0YWcgaW4gdGFncyBpZiB0YWcgbm90IGluIHVzZWRfdGFnc10KICAgICAgICBpZiB1bnVzZWQ6CiAgICAgICAgICAgIHVudXNlZF90YWdzW2dyb3VwXSA9IHVudXNlZAoKICAgIHNlbnRfbWVzc2FnZXMgPSBbXQoKICAgICMgU2VuZCBtZXNzYWdlIGFib3V0IHVudXNlZCB0YWdzIGZpcnN0IGlmIGFueSBleGlzdAogICAgaWYgdW51c2VkX3RhZ3M6CiAgICAgICAgdW51c2VkX21zZyA9ICLwn5OMICoqVGFncyBjaMawYSBjw7MgVUlEIG7DoG86KipcblxuIgogICAgICAgIGZvciBncm91cCwgdGFncyBpbiB1bnVzZWRfdGFncy5pdGVtcygpOgogICAgICAgICAgICB1bnVzZWRfbXNnICs9IGYiKip7Z3JvdXB9KipcbiIKICAgICAgICAgICAgZm9yIHRhZyBpbiB0YWdzOgogICAgICAgICAgICAgICAgdW51c2VkX21zZyArPSBmIuKUlCBge3RhZ31gXG4iCiAgICAgICAgICAgIHVudXNlZF9tc2cgKz0gIlxuIgogICAgICAgIHNlbnQgPSBhd2FpdCB1cGRhdGUubWVzc2FnZS5yZXBseV90ZXh0KHVudXNlZF9tc2csIHBhcnNlX21vZGU9Ik1hcmtkb3duIikKICAgICAgICBzZW50X21lc3NhZ2VzLmFwcGVuZChzZW50Lm1lc3NhZ2VfaWQpCgogICAgIyBTZW5kIG1lc3NhZ2UgZm9yIGVhY2ggRnVubnkgZ3JvdXAsIG9yZ2FuaXplZCBieSB0YWcKICAgIGZvciBncm91cCwgdGFnc19kaWN0IGluIGdyb3VwZWRfZGF0YS5pdGVtcygpOgogICAgICAgIGlmIHRhZ3NfZGljdDogICMgT25seSBzaG93IGdyb3VwcyB0aGF0IGhhdmUgaXRlbXMKICAgICAgICAgICAgdG90YWxfdWlkcyA9IHN1bShsZW4odWlkcykgZm9yIHVpZHMgaW4gdGFnc19kaWN0LnZhbHVlcygpKQogICAgICAgICAgICBncm91cF9tZXNzYWdlID0gZiLwn5OLICoqe2dyb3VwfSoqICh7dG90YWxfdWlkc30gVUlEKVxuXG4iCgogICAgICAgICAgICAjIFNvcnQgdGFncyBmb3IgY29uc2lzdGVudCBkaXNwbGF5CiAgICAgICAgICAgIGZvciB0YWcgaW4gc29ydGVkKHRhZ3NfZGljdC5rZXlzKCkpOgogICAgICAgICAgICAgICAgdWlkcyA9IHRhZ3NfZGljdFt0YWddCiAgICAgICAgICAgICAgICBpZiB1aWRzOiAgIyBPbmx5IHNob3cgdGFncyB0aGF0IGhhdmUgVUlEcwogICAgICAgICAgICAgICAgICAgIGdyb3VwX21lc3NhZ2UgKz0gZiJ0YWcge3RhZ30gXG4iCiAgICAgICAgICAgICAgICAgICAgIyBTb3J0IFVJRHMgYnkgY29tcGxldGlvbiBwZXJjZW50YWdlCiAgICAgICAgICAgICAgICAgICAgc29ydGVkX3VpZHMgPSBzb3J0ZWQodWlkcywga2V5PWxhbWJkYSB4OiB4WzFdLCByZXZlcnNlPVRydWUpCiAgICAgICAgICAgICAgICAgICAgZm9yIHVpZCwgcGVyY2VudCBpbiBzb3J0ZWRfdWlkczoKICAgICAgICAgICAgICAgICAgICAgICAgc3RhdHVzID0gIuKchSIgaWYgcGVyY2VudCA+PSAxMDAgZWxzZSAi4p2MIgogICAgICAgICAgICAgICAgICAgICAgICBncm91cF9tZXNzYWdlICs9IGYi4pSUIGB7dWlkfWAgKHt0YWd9OiB7cGVyY2VudH0lKSB7c3RhdHVzfVxuIgogICAgICAgICAgICAgICAgICAgIGdyb3VwX21lc3NhZ2UgKz0gIlxuIgoKICAgICAgICAgICAgc2VudCA9IGF3YWl0IHVwZGF0ZS5tZXNzYWdlLnJlcGx5X3RleHQoZ3JvdXBfbWVzc2FnZSwgcGFyc2VfbW9kZT0iTWFya2Rvd24iKQogICAgICAgICAgICBzZW50X21lc3NhZ2VzLmFwcGVuZChzZW50Lm1lc3NhZ2VfaWQpCgogICAgIyBTZW5kIG1lc3NhZ2UgZm9yIG90aGVyIHRhZ3MsIG9yZ2FuaXplZCBieSB0YWcKICAgIGlmIG90aGVyX3RhZ3M6CiAgICAgICAgdG90YWxfb3RoZXJfdWlkcyA9IHN1bShsZW4odWlkcykgZm9yIHVpZHMgaW4gb3RoZXJfdGFncy52YWx1ZXMoKSkKICAgICAgICBvdGhlcl9tZXNzYWdlID0gZiLwn5OLICoqS2jDoWMqKiAoe3RvdGFsX290aGVyX3VpZHN9IFVJRClcblxuIgoKICAgICAgICAjIFNvcnQgdGFncyBmb3IgY29uc2lzdGVudCBkaXNwbGF5CiAgICAgICAgZm9yIHRhZyBpbiBzb3J0ZWQob3RoZXJfdGFncy5rZXlzKCkpOgogICAgICAgICAgICB1aWRzID0gb3RoZXJfdGFnc1t0YWddCiAgICAgICAgICAgIG90aGVyX21lc3NhZ2UgKz0gZiJ0YWcge3RhZ30gXG4iCiAgICAgICAgICAgICMgU29ydCBVSURzIGJ5IGNvbXBsZXRpb24gcGVyY2VudGFnZQogICAgICAgICAgICBzb3J0ZWRfdWlkcyA9IHNvcnRlZCh1aWRzLCBrZXk9bGFtYmRhIHg6IHhbMV0sIHJldmVyc2U9VHJ1ZSkKICAgICAgICAgICAgZm9yIHVpZCwgcGVyY2VudCBpbiBzb3J0ZWRfdWlkczoKICAgICAgICAgICAgICAgIHN0YXR1cyA9ICLinIUiIGlmIHBlcmNlbnQgPj0gMTAwIGVsc2UgIuKdjCIKICAgICAgICAgICAgICAgIG90aGVyX21lc3NhZ2UgKz0gZiLilJQgYHt1aWR9YCAoe3RhZ306IHtwZXJjZW50fSUpIHtzdGF0dXN9XG4iCiAgICAgICAgICAgIG90aGVyX21lc3NhZ2UgKz0gIlxuIgoKICAgICAgICBzZW50ID0gYXdhaXQgdXBkYXRlLm1lc3NhZ2UucmVwbHlfdGV4dChvdGhlcl9tZXNzYWdlLCBwYXJzZV9tb2RlPSJNYXJrZG93biIpCiAgICAgICAgc2VudF9tZXNzYWdlcy5hcHBlbmQoc2VudC5tZXNzYWdlX2lkKQoKICAgICMgU2NoZWR1bGUgZGVsZXRpb24gYWZ0ZXIgMyBtaW51dGVzCiAgICBjb250ZXh0LmpvYl9xdWV1ZS5ydW5fb25jZSgKICAgICAgICBkZWxldGVfbWVzc2FnZSwKICAgICAgICAxODAsCiAgICAgICAgZGF0YT1bdXBkYXRlLm1lc3NhZ2UubWVzc2FnZV9pZF0gKyBzZW50X21lc3NhZ2VzLAogICAgICAgIGNoYXRfaWQ9dXBkYXRlLmVmZmVjdGl2ZV9jaGF0LmlkKQoKCmFzeW5jIGRlZiB0b3RhbF9saXN0KHVwZGF0ZTogVXBkYXRlLCBjb250ZXh0OiBDb250ZXh0VHlwZXMuREVGQVVMVF9UWVBFKToKICAgIHVzZXJfaWQgPSB1cGRhdGUubWVzc2FnZS5mcm9tX3VzZXIuaWQgaWYgdXBkYXRlLm1lc3NhZ2UgZWxzZSB1cGRhdGUuY2FsbGJhY2tfcXVlcnkuZnJvbV91c2VyLmlkCiAgICBpZiBub3QgaXNfYWRtaW4odXNlcl9pZCk6CiAgICAgICAgYXdhaXQgc2VuZF9yZXBseV9hbmRfc2NoZWR1bGVfZGVsZXRpb24odXBkYXRlLCBjb250ZXh0LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICLimqDvuI8gVHJ1eSBj4bqtcCBi4buLIHThu6sgY2jhu5FpISIpCiAgICAgICAgcmV0dXJuCgogICAgY3Vyc29yLmV4ZWN1dGUoJycnCiAgICAgICAgU0VMRUNUIHRhZywgCiAgICAgICAgICAgICAgIENPVU5UKCopIGFzIGNvdW50LAogICAgICAgICAgICAgICBTVU0odG90YWwpIGFzIHRvdGFsX2hlYXJ0cywKICAgICAgICAgICAgICAgU1VNKGN1cnJlbnQpIGFzIGN1cnJlbnRfaGVhcnRzLAogICAgICAgICAgICAgICBTVU0odG90YWwgLSBjdXJyZW50KSBhcyByZW1haW5pbmdfaGVhcnRzCiAgICAgICAgRlJPTSB0cmFuc2FjdGlvbnMgCiAgICAgICAgR1JPVVAgQlkgdGFnCiAgICAgICAgT1JERVIgQlkgU1VNKHRvdGFsIC0gY3VycmVudCkgREVTQwogICAgJycnKQogICAgcmVzdWx0cyA9IGN1cnNvci5mZXRjaGFsbCgpCgogICAgaWYgbm90IHJlc3VsdHM6CiAgICAgICAgYXdhaXQgdXBkYXRlLm1lc3NhZ2UucmVwbHlfdGV4dCgi8J+TgiBLaMO0bmcgY8OzIGThu68gbGnhu4d1IG7DoG8uIikKICAgICAgICByZXR1cm4KCiAgICBtZXNzYWdlID0gIvCfk4ogKipUaOG7kW5nIGvDqiB0aGVvIHRhZzoqKlxuXG4iCiAgICB0b3RhbF9hbGwgPSAwCgogICAgZm9yIHRhZywgY291bnQsIHRvdGFsLCBjdXJyZW50LCByZW1haW5pbmcgaW4gcmVzdWx0czoKICAgICAgICBpZiByZW1haW5pbmc6ICAjIE9ubHkgc2hvdyB0YWdzIHdpdGggcmVtYWluaW5nIGhlYXJ0cwogICAgICAgICAgICBtZXNzYWdlICs9IChmIvCflLkgKip7dGFnfSoqXG4iCiAgICAgICAgICAgICAgICAgICAgICAgIGYi4pScIFPhu5EgVUlEOiB7Y291bnR9XG4iCiAgICAgICAgICAgICAgICAgICAgICAgIGYi4pScIFThu5VuZyB0aW06IHtmb3JtYXRfbnVtYmVyKHRvdGFsKX3inaTvuI9cbiIKICAgICAgICAgICAgICAgICAgICAgICAgZiLilJwgSGnhu4duIHThuqFpOiB7Zm9ybWF0X251bWJlcihjdXJyZW50KX3inaTvuI9cbiIKICAgICAgICAgICAgICAgICAgICAgICAgZiLilJQgQ8OybiBs4bqhaToge2Zvcm1hdF9udW1iZXIocmVtYWluaW5nKX3inaTvuI9cblxuIikKICAgICAgICAgICAgdG90YWxfYWxsICs9IHJlbWFpbmluZwoKICAgIG1lc3NhZ2UgKz0gZiJcbvCfkqsgKipU4buVbmcgdGltIGPDsm4gbOG6oWk6IHtmb3JtYXRfbnVtYmVyKHRvdGFsX2FsbCl94p2k77iPKioiCgogICAgIyBTcGxpdCBhbmQgc2VuZCBtZXNzYWdlIGlmIHRvbyBsb25nCiAgICBtZXNzYWdlcyA9IHNwbGl0X21lc3NhZ2UobWVzc2FnZSkKICAgIHNlbnRfbWVzc2FnZXMgPSBbXQogICAgZm9yIHBhcnQgaW4gbWVzc2FnZXM6CiAgICAgICAgc2VudCA9IGF3YWl0IHVwZGF0ZS5tZXNzYWdlLnJlcGx5X3RleHQocGFydCwgcGFyc2VfbW9kZT0iTWFya2Rvd24iKQogICAgICAgIHNlbnRfbWVzc2FnZXMuYXBwZW5kKHNlbnQubWVzc2FnZV9pZCkKCiAgICAjIFNjaGVkdWxlIGRlbGV0aW9uIGFmdGVyIDYwIHNlY29uZHMKICAgIGNvbnRleHQuam9iX3F1ZXVlLnJ1bl9vbmNlKGRlbGV0ZV9tZXNzYWdlLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgNjAsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhPVt1cGRhdGUubWVzc2FnZS5tZXNzYWdlX2lkXSArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZW50X21lc3NhZ2VzLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2hhdF9pZD11cGRhdGUuZWZmZWN0aXZlX2NoYXQuaWQpCgoKYXN5bmMgZGVmIHRvdGFsX2hlYXJ0cyh1cGRhdGU6IFVwZGF0ZSwgY29udGV4dDogQ29udGV4dFR5cGVzLkRFRkFVTFRfVFlQRSk6CiAgICBpZiBub3QgaXNfYWRtaW4odXBkYXRlLm1lc3NhZ2UuZnJvbV91c2VyLmlkKToKICAgICAgICBhd2FpdCBzZW5kX3JlcGx5X2FuZF9zY2hlZHVsZV9kZWxldGlvbih1cGRhdGUsIGNvbnRleHQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIuKaoO+4jyBUcnV5IGPhuq1wIGLhu4sgdOG7qyBjaOG7kWkhIikKICAgICAgICByZXR1cm4KICAgIGN1cnNvci5leGVjdXRlKCdTRUxFQ1QgU1VNKHRvdGFsIC0gY3VycmVudCkgRlJPTSB0cmFuc2FjdGlvbnMnKQogICAgdG90YWwgPSBjdXJzb3IuZmV0Y2hvbmUoKVswXSBvciAwCgogICAgbWVzc2FnZSA9IGYi4p2k77iPIFThu5VuZyBz4buRIHRpbSBjw7JuIGzhuqFpIGPhu6dhIHThuqV0IGPhuqMgVUlEOiB7Zm9ybWF0X251bWJlcih0b3RhbCl94p2k77iPIgogICAgcmVzcG9uc2UgPSBhd2FpdCB1cGRhdGUubWVzc2FnZS5yZXBseV90ZXh0KG1lc3NhZ2UsIHBhcnNlX21vZGU9Ik1hcmtkb3duIikKCiAgICBjb250ZXh0LmpvYl9xdWV1ZS5ydW5fb25jZSgKICAgICAgICBkZWxldGVfbWVzc2FnZSwKICAgICAgICAzMCwKICAgICAgICBkYXRhPVt1cGRhdGUubWVzc2FnZS5tZXNzYWdlX2lkLCByZXNwb25zZS5tZXNzYWdlX2lkXSwKICAgICAgICBjaGF0X2lkPXVwZGF0ZS5lZmZlY3RpdmVfY2hhdC5pZCkKCgpkZWYgbG9hZF9ub3RlcygpOgoKICAgICIiIsSQ4buNYyBk4buvIGxp4buHdSB04burIGZpbGUgSlNPTi4gTuG6v3UgZmlsZSBraMO0bmcgdOG7k24gdOG6oWksIHRy4bqjIHbhu4EgZGljdGlvbmFyeSBy4buXbmcuIiIiCgogICAgaWYgbm90IG9zLnBhdGguZXhpc3RzKCdub3Rlcy5qc29uJyk6CiAgICAgICAgcmV0dXJuIHt9CgogICAgd2l0aCBvcGVuKCdub3Rlcy5qc29uJywgJ3InLCBlbmNvZGluZz0ndXRmLTgnKSBhcyBmOgogICAgICAgIHJldHVybiBqc29uLmxvYWQoZikKCgpkZWYgc2F2ZV9ub3Rlcyhub3Rlcyk6CgogICAgIiIiTMawdSB0b8OgbiBi4buZIGThu68gbGnhu4d1IHbDoG8gZmlsZSBKU09OLiIiIgogICAgd2l0aCBvcGVuKCdub3Rlcy5qc29uJywgJ3cnLCBlbmNvZGluZz0ndXRmLTgnKSBhcyBmOgoKICAgICAgICBqc29uLmR1bXAobm90ZXMsIGYsIGVuc3VyZV9hc2NpaT1GYWxzZSwgaW5kZW50PTIpCgoKYXN5bmMgZGVmIHRvdGFsX25vdGUodXBkYXRlOiBVcGRhdGUsIGNvbnRleHQ6IENvbnRleHRUeXBlcy5ERUZBVUxUX1RZUEUpOgogICAgaWYgbm90IGlzX2FkbWluKHVwZGF0ZS5tZXNzYWdlLmZyb21fdXNlci5pZCk6CiAgICAgICAgYXdhaXQgc2VuZF9yZXBseV9hbmRfc2NoZWR1bGVfZGVsZXRpb24odXBkYXRlLCBjb250ZXh0LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICLimqDvuI8gVHJ1eSBj4bqtcCBi4buLIHThu6sgY2jhu5FpISIpCiAgICAgICAgcmV0dXJuCgogICAgbm90ZXMgPSBsb2FkX25vdGVzKCkKICAgIGlmIG5vdCBub3RlczoKICAgICAgICByZXNwb25zZSA9IGF3YWl0IHVwZGF0ZS5tZXNzYWdlLnJlcGx5X3RleHQoIvCfk4IgS2jDtG5nIGPDsyBsxrB1IMO9IG7DoG8uIikKICAgICAgICBjb250ZXh0LmpvYl9xdWV1ZS5ydW5fb25jZSgKICAgICAgICAgICAgZGVsZXRlX21lc3NhZ2UsCiAgICAgICAgICAgIDE4MCwKICAgICAgICAgICAgZGF0YT1bdXBkYXRlLm1lc3NhZ2UubWVzc2FnZV9pZCwgcmVzcG9uc2UubWVzc2FnZV9pZF0sCiAgICAgICAgICAgIGNoYXRfaWQ9dXBkYXRlLmVmZmVjdGl2ZV9jaGF0LmlkKQogICAgICAgIHJldHVybgoKICAgICMgUGjDom4gdMOtY2ggdsOgIG5ow7NtIHRoZW8gdGjhu51pIGdpYW4KICAgIHRpbWVfZ3JvdXBzID0ge30KICAgIGZvciB1aWQsIG5vdGUgaW4gbm90ZXMuaXRlbXMoKToKICAgICAgICBpZiBsZW4odWlkKSA+IDE1OgogICAgICAgICAgICBjb250aW51ZSAKCiAgICAgICAgIyBTa2lwIGlmIFVJRCBpcyBsb25nZXIgdGhhbiAxNSBjaGFyYWN0ZXJzCgogICAgICAgICMgVMOsbSBnaeG7nSB0cm9uZyBub3RlICh2w60gZOG7pTogIjRoIiwgIjE1aCIpCgogICAgICAgIGlmIG5vdGUgYW5kICJoIiBpbiBub3RlLmxvd2VyKCk6CiAgICAgICAgICAgIHRyeToKICAgICAgICAgICAgICAgIGhvdXIgPSBpbnQobm90ZS5sb3dlcigpLnJlcGxhY2UoImgiLCAiIikpCiAgICAgICAgICAgICAgICBpZiBob3VyIG5vdCBpbiB0aW1lX2dyb3VwczoKICAgICAgICAgICAgICAgICAgICB0aW1lX2dyb3Vwc1tob3VyXSA9IFtdCiAgICAgICAgICAgICAgICB0aW1lX2dyb3Vwc1tob3VyXS5hcHBlbmQodWlkKQogICAgICAgICAgICBleGNlcHQgVmFsdWVFcnJvcjoKICAgICAgICAgICAgICAgIGNvbnRpbnVlCgogICAgIyBU4bqhbyB0aOG7kW5nIGvDqgogICAgbWVzc2FnZSA9ICLwn5OKICoqVGjhu5FuZyBrw6ogdGhlbyB0aOG7nWkgZ2lhbjoqKlxuXG4iCgogICAgIyBT4bqvcCB44bq/cCB0aGVvIGdp4budCiAgICBmb3IgaG91ciBpbiBzb3J0ZWQodGltZV9ncm91cHMua2V5cygpKToKICAgICAgICB1aWRzID0gdGltZV9ncm91cHNbaG91cl0KICAgICAgICBtZXNzYWdlICs9IGYi8J+VkCAqKntob3VyfWgqKiAoe2xlbih1aWRzKX0gVUlEKTpcbiIKCiAgICAgICAgZm9yIHVpZCBpbiB1aWRzOgoKICAgICAgICAgICAgbWVzc2FnZSArPSBmIuKUlCBge3VpZH1gXG4iCgogICAgICAgIG1lc3NhZ2UgKz0gIlxuIgoKCiAgICBtZXNzYWdlICs9ICJcbvCfk4sgKipDaGkgdGnhur90IHThu6tuZyBVSUQ6KipcblxuIgoKICAgIGZvciB1aWQsIG5vdGUgaW4gbm90ZXMuaXRlbXMoKToKCiAgICAgICAgaWYgbGVuKHVpZCkgPiAxNToKCiAgICAgICAgICAgIGNvbnRpbnVlCgogICAgICAgIG1lc3NhZ2UgKz0gZiLwn5S5IFVJRDogYHt1aWR9YFxuIgoKICAgICAgICBpZiBub3RlOgoKICAgICAgICAgICAgbWVzc2FnZSArPSBmIiAgIEzGsHUgw706IHtub3RlfVxuIgoKICAgICAgICBtZXNzYWdlICs9ICJcbiIKCiAgICBtZXNzYWdlcyA9IHNwbGl0X21lc3NhZ2UobWVzc2FnZSkKCiAgICBzZW50X21lc3NhZ2VzID0gW10KICAgIGZvciBwYXJ0IGluIG1lc3NhZ2VzOgogICAgICAgIHNlbnQgPSBhd2FpdCB1cGRhdGUubWVzc2FnZS5yZXBseV90ZXh0KHBhcnQsIHBhcnNlX21vZGU9Ik1hcmtkb3duIikKICAgICAgICBzZW50X21lc3NhZ2VzLmFwcGVuZChzZW50Lm1lc3NhZ2VfaWQpCgogICAgY29udGV4dC5qb2JfcXVldWUucnVuX29uY2UoZGVsZXRlX21lc3NhZ2UsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAxODAsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBkYXRhPVt1cGRhdGUubWVzc2FnZS5tZXNzYWdlX2lkXSArCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZW50X21lc3NhZ2VzLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY2hhdF9pZD11cGRhdGUuZWZmZWN0aXZlX2NoYXQuaWQpCgoKYXN5bmMgZGVmIG5vdGUodXBkYXRlOiBVcGRhdGUsIGNvbnRleHQ6IENvbnRleHRUeXBlcy5ERUZBVUxUX1RZUEUpOgoKICAgICMgR2V0IHRoZSB1c2VyIElEIGZyb20gZWl0aGVyIGNhbGxiYWNrIHF1ZXJ5IG9yIG1lc3NhZ2UKICAgIGlmIHVwZGF0ZS5jYWxsYmFja19xdWVyeToKICAgICAgICB1c2VyX2lkID0gdXBkYXRlLmNhbGxiYWNrX3F1ZXJ5LmZyb21fdXNlci5pZAogICAgICAgIG1lc3NhZ2UgPSB1cGRhdGUuY2FsbGJhY2tfcXVlcnkubWVzc2FnZQogICAgZWxzZToKICAgICAgICB1c2VyX2lkID0gdXBkYXRlLm1lc3NhZ2UuZnJvbV91c2VyLmlkCiAgICAgICAgbWVzc2FnZSA9IHVwZGF0ZS5tZXNzYWdlCgogICAgaWYgbm90IGlzX2FkbWluKHVzZXJfaWQpOgogICAgICAgIGF3YWl0IHNlbmRfcmVwbHlfYW5kX3NjaGVkdWxlX2RlbGV0aW9uKHVwZGF0ZSwgY29udGV4dCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIuKaoO+4jyBUcnV5IGPhuq1wIGLhu4sgdOG7qyBjaOG7kWkhIikKICAgICAgICByZXR1cm4KICAgIHRyeToKICAgICAgICBhcmdzID0gY29udGV4dC5hcmdzCiAgICAgICAgaWYgbGVuKGFyZ3MpIDwgMToKICAgICAgICAgICAgYXdhaXQgc2VuZF9yZXBseV9hbmRfc2NoZWR1bGVfZGVsZXRpb24oCiAgICAgICAgICAgICAgICB1cGRhdGUsIGNvbnRleHQsCiAgICAgICAgICAgICAgICAi4pqg77iPICoqQ8O6IHBow6FwOioqXG5gL25vdGUgW1VJRF0gW1TDqm4ga2jDoWNoIGjDoG5nIChraMO0bmcgYuG6r3QgYnXhu5ljKV1gXG5Ww60gZOG7pTogYC9ub3RlIFVJRDEyMyB0aOG7nWkgZ2lhbmAiCiAgICAgICAgICAgICkKICAgICAgICAgICAgcmV0dXJuCgogICAgICAgIHVpZCA9IGFyZ3NbMF0KICAgICAgICBpZiBsZW4odWlkKSA+IDE2NToKICAgICAgICAgICAgYXdhaXQgc2VuZF9yZXBseV9hbmRfc2NoZWR1bGVfZGVsZXRpb24oCiAgICAgICAgICAgICAgICB1cGRhdGUsIGNvbnRleHQsICLimqDvuI8gVUlEIGtow7RuZyDEkcaw4bujYyB2xrDhu6N0IHF1w6EgMTY1IGvDvSB04buxISIpCiAgICAgICAgICAgIHJldHVybgoKICAgICAgICBjdXN0b21lcl9uYW1lID0gJyAnLmpvaW4oCiAgICAgICAgICAgIGFyZ3NbMTpdKSBpZiBsZW4oYXJncykgPiAxIGVsc2UgIiIgICMgVMOqbiBraMOhY2ggaMOgbmcga2jDtG5nIGLhuq90IGJ14buZYwoKICAgICAgICAjIExvYWQgZXhpc3Rpbmcgbm90ZXMKICAgICAgICBub3RlcyA9IGxvYWRfbm90ZXMoKQoKICAgICAgICAjIFVwZGF0ZSBvciBhZGQgdGhlIG5vdGUgZm9yIHRoZSBVSUQKICAgICAgICBub3Rlc1t1aWRdID0gY3VzdG9tZXJfbmFtZQogICAgICAgIHNhdmVfbm90ZXMobm90ZXMpCgogICAgICAgIHJlc3BvbnNlID0gYXdhaXQgbWVzc2FnZS5yZXBseV90ZXh0KAogICAgICAgICAgICBmIuKchSBUw6puIGtow6FjaCBow6BuZyDEkcOjIMSRxrDhu6NjIGPhuq1wIG5o4bqtdCBjaG8gVUlEIGB7dWlkfWA6XG57Y3VzdG9tZXJfbmFtZX0iLAogICAgICAgICAgICBwYXJzZV9tb2RlPSJNYXJrZG93biIpCiAgICAgICAgY29udGV4dC5qb2JfcXVldWUucnVuX29uY2UoCiAgICAgICAgICAgIGRlbGV0ZV9tZXNzYWdlLAogICAgICAgICAgICAxODAsCiAgICAgICAgICAgIGRhdGE9W3VwZGF0ZS5tZXNzYWdlLm1lc3NhZ2VfaWQsIHJlc3BvbnNlLm1lc3NhZ2VfaWRdLAogICAgICAgICAgICBjaGF0X2lkPXVwZGF0ZS5lZmZlY3RpdmVfY2hhdC5pZCkKICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICBhd2FpdCBzZW5kX3JlcGx5X2FuZF9zY2hlZHVsZV9kZWxldGlvbih1cGRhdGUsIGNvbnRleHQsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGYi4pqg77iPIEzhu5dpOiBge3N0cihlKX1gIikKCgphc3luYyBkZWYgY2hlY2tfYW5kX3JlbW92ZV9ub3Rlcyhjb250ZXh0OiBDb250ZXh0VHlwZXMuREVGQVVMVF9UWVBFKToKICAgIGN1cnNvci5leGVjdXRlKCdTRUxFQ1QgdWlkIEZST00gdHJhbnNhY3Rpb25zJykKICAgIGV4aXN0aW5nX3VpZHMgPSB7cm93WzBdIGZvciByb3cgaW4gY3Vyc29yLmZldGNoYWxsKCl9CgoKICAgIG5vdGVzID0gbG9hZF9ub3RlcygpCiAgICBmb3IgdWlkIGluIGxpc3Qobm90ZXMua2V5cygpKToKICAgICAgICBpZiB1aWQgaW4gZXhpc3RpbmdfdWlkczoKICAgICAgICAgICAgZGVsIG5vdGVzW3VpZF0KCiAgICBzYXZlX25vdGVzKG5vdGVzKQoKCmlmIF9fbmFtZV9fID09ICdfX21haW5fXyc6CiAgICByZXRyeV9jb3VudCA9IDAKICAgIG1heF9yZXRyaWVzID0gNQoKICAgIHdoaWxlIHJldHJ5X2NvdW50IDwgbWF4X3JldHJpZXM6CiAgICAgICAgdHJ5OgogICAgICAgICAgICBhcHAgPSAoQXBwbGljYXRpb25CdWlsZGVyKCkudG9rZW4oVE9LRU4pLnBvc3RfaW5pdChzZXRfY29tbWFuZHMpLgogICAgICAgICAgICAgICAgICAgZ2V0X3VwZGF0ZXNfY29ubmVjdF90aW1lb3V0KDMwLjApLmdldF91cGRhdGVzX3JlYWRfdGltZW91dCgKICAgICAgICAgICAgICAgICAgICAgICAzMC4wKS5nZXRfdXBkYXRlc193cml0ZV90aW1lb3V0KDMwLjApLmJ1aWxkKCkpCiAgICAgICAgICAgIGpvYl9xdWV1ZSA9IGFwcC5qb2JfcXVldWUKICAgICAgICAgICAgaWYgam9iX3F1ZXVlOgogICAgICAgICAgICAgICAgam9iX3F1ZXVlLnJ1bl9kYWlseShhdXRvX3VwZGF0ZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgdGltZT10aW1lKDIwLCA1MCwgdHppbmZvPVRJTUVaT05FKSkKICAgICAgICAgICAgICAgIGpvYl9xdWV1ZS5ydW5fcmVwZWF0aW5nKGNoZWNrX2FuZF9yZW1vdmVfbm90ZXMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBpbnRlcnZhbD01LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlyc3Q9MCkKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIHByaW50KAogICAgICAgICAgICAgICAgICAgICLimqDvuI8gSm9iUXVldWUga2jDtG5nIGto4bqjIGThu6VuZy4gVnVpIGzDsm5nIGPDoGkgxJHhurd0ICdweXRob24tdGVsZWdyYW0tYm90W2pvYi1xdWV1ZV0nLiIKICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgIyBCYXNpYyBjb21tYW5kcyBmb3IgYWxsIHVzZXJzCiAgICAgICAgICAgIGFwcC5hZGRfaGFuZGxlcihDb21tYW5kSGFuZGxlcigic3RhcnQiLCBzdGFydCkpCiAgICAgICAgICAgIGFwcC5hZGRfaGFuZGxlcihDb21tYW5kSGFuZGxlcigiY2hlY2siLCBjaGVja19wcm9ncmVzcykpCgogICAgICAgICAgICAjIEFkbWluLW9ubHkgY29tbWFuZHMKICAgICAgICAgICAgYXBwLmFkZF9oYW5kbGVyKENvbW1hbmRIYW5kbGVyKCJhZGQiLCBhZGRfcHJvZ3Jlc3MpKQogICAgICAgICAgICBhcHAuYWRkX2hhbmRsZXIoQ29tbWFuZEhhbmRsZXIoImRlbCIsIGRlbF91aWQpKQogICAgICAgICAgICBhcHAuYWRkX2hhbmRsZXIoQ29tbWFuZEhhbmRsZXIoImxpc3QiLCBsaXN0X3VpZHNfYnlfdGFnKSkKICAgICAgICAgICAgYXBwLmFkZF9oYW5kbGVyKENvbW1hbmRIYW5kbGVyKCJ0b3RhbF9oZWFydHMiLCB0b3RhbF9oZWFydHMpKQogICAgICAgICAgICBhcHAuYWRkX2hhbmRsZXIoQ29tbWFuZEhhbmRsZXIoInRvdGFsX2xpc3QiLCB0b3RhbF9saXN0KSkKICAgICAgICAgICAgYXBwLmFkZF9oYW5kbGVyKENvbW1hbmRIYW5kbGVyKCJ0b2dnbGVfYXV0byIsIHRvZ2dsZV9hdXRvKSkKICAgICAgICAgICAgYXBwLmFkZF9oYW5kbGVyKENvbW1hbmRIYW5kbGVyKCJub3RlIiwgbm90ZSkpCiAgICAgICAgICAgIGFwcC5hZGRfaGFuZGxlcihDb21tYW5kSGFuZGxlcigidG90YWxfbm90ZSIsIHRvdGFsX25vdGUpKQogICAgICAgICAgICBhcHAuYWRkX2hhbmRsZXIoQ2FsbGJhY2tRdWVyeUhhbmRsZXIoYnV0dG9uX2NhbGxiYWNrKSkKICAgICAgICAgICAgcHJpbnQoIvCfn6IgQm90IMSRYW5nIGNo4bqheS4uLiIpCiAgICAgICAgICAgIGFwcC5ydW5fcG9sbGluZyhkcm9wX3BlbmRpbmdfdXBkYXRlcz1UcnVlKQogICAgICAgICAgICBicmVhawogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZToKICAgICAgICAgICAgcmV0cnlfY291bnQgKz0gMQogICAgICAgICAgICB3YWl0X3RpbWUgPSBtaW4oMzAsIDUgKiByZXRyeV9jb3VudCkgICMgRXhwb25lbnRpYWwgYmFja29mZgogICAgICAgICAgICBwcmludChmIuKaoO+4jyBM4buXaSBr4bq/dCBu4buRaSAoe3JldHJ5X2NvdW50fS97bWF4X3JldHJpZXN9KToge3N0cihlKX0iKQogICAgICAgICAgICBwcmludChmIvCflIQgxJBhbmcgdGjhu60ga+G6v3QgbuG7kWkgbOG6oWkgc2F1IHt3YWl0X3RpbWV9IGdpw6J5Li4uIikKICAgICAgICAgICAgaW1wb3J0IGFzeW5jaW8KICAgICAgICAgICAgaW1wb3J0IHRpbWUKICAgICAgICAgICAgdGltZS5zbGVlcCh3YWl0X3RpbWUpCiAgICAgICAgICAgIGNvbnRpbnVlCgogICAgaWYgcmV0cnlfY291bnQgPj0gbWF4X3JldHJpZXM6CiAgICAgICAgcHJpbnQoCiAgICAgICAgICAgICLinYwgxJDDoyB2xrDhu6N0IHF1w6Egc+G7kSBs4bqnbiB0aOG7rSBr4bq/dCBu4buRaSB04buRaSDEkWEuIFZ1aSBsw7JuZyBraeG7g20gdHJhIGzhuqFpIGvhur90IG7hu5FpIG3huqFuZyB2w6AgdG9rZW4gYm90LiIKICAgICAgICApCiAgICAgICAgcHJpbnQoCiAgICAgICAgICAgICLinYwgxJDDoyB2xrDhu6N0IHF1w6Egc+G7kSBs4bqnbiB0aOG7rSBr4bq/dCBu4buRaSB04buRaSDEkWEuIFZ1aSBsw7JuZyBraeG7g20gdHJhIGzhuqFpIGvhur90IG7hu5FpIG3huqFuZyB2w6AgdG9rZW4gYm90LiIKICAgICAgICAp"
    decoded_content = base64.b64decode(encoded_content.encode('utf-8')).decode('utf-8')
    
    # Thc thi m  gii m
    exec(decoded_content, globals())

if __name__ == '__main__':
    decrypt_and_run()
